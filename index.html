<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards + Comparateur</title>
    <style>
        /* STYLES D'AUTHENTIFICATION - STYLE NETFLIX */
        .auth-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                        url('https://images.unsplash.com/photo-1481627834876-b7833e8f5570?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 10000;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }
        
        .auth-container {
            background: rgba(0, 0, 0, 0.75);
            border-radius: 8px;
            padding: 60px 68px 40px;
            width: 100%;
            max-width: 450px;
            color: white;
        }
        
        .auth-header {
            text-align: left;
            margin-bottom: 28px;
        }
        
        .auth-header h1 {
            color: #e50914;
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 700;
        }
        
        .auth-header p {
            color: #8c8c8c;
            font-size: 16px;
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .auth-input-group input {
            width: 100%;
            padding: 16px 20px;
            border: none;
            border-radius: 4px;
            background: #333;
            color: white;
            font-size: 16px;
            margin-bottom: 16px;
        }
        
        .auth-input-group input:focus {
            outline: none;
            background: #454545;
        }
        
        .auth-button {
            background: #e50914;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 24px;
            width: 100%;
        }
        
        .auth-button:hover {
            background: #f40612;
        }
        
        .auth-toggle {
            color: #8c8c8c;
            text-align: left;
            margin-top: 16px;
        }
        
        .auth-toggle a {
            color: white;
            text-decoration: none;
            cursor: pointer;
            font-weight: 500;
        }
        
        .auth-toggle a:hover {
            text-decoration: underline;
        }
        
        .guest-button {
            background: transparent;
            color: #8c8c8c;
            border: 1px solid #8c8c8c;
            padding: 16px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 16px;
            width: 100%;
        }
        
        .guest-button:hover {
            color: white;
            border-color: white;
        }
        
        .auth-error, .auth-success {
            background: #e87c03;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 14px;
        }
        
        .auth-success {
            background: #2ecc71;
        }

        /* Style pour la page d'accueil après connexion */
        .homepage {
            background: #141414;
            min-height: 100vh;
            color: white;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }
        
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 20px 4%;
            background: linear-gradient(180deg, rgba(0,0,0,0.7) 10%, transparent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }
        
        .navbar-brand {
            color: #e50914;
            font-size: 28px;
            font-weight: 700;
            text-decoration: none;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            font-size: 14px;
        }
        
        .nav-links a:hover {
            color: #b3b3b3;
        }
        
        .nav-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .profile-avatar {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            background: #e50914;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .hero {
            padding-top: 100px;
            padding-left: 4%;
            padding-right: 4%;
        }
        
        .hero h1 {
            font-size: 3.5vw;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .hero p {
            font-size: 1.2vw;
            color: #b3b3b3;
            max-width: 600px;
            margin-bottom: 30px;
        }
        
        .hero-buttons {
            display: flex;
            gap: 16px;
            margin-bottom: 50px;
        }
        
        .btn-play {
            background: white;
            color: black;
            padding: 8px 24px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .btn-info {
            background: rgba(109, 109, 110, 0.7);
            color: white;
            padding: 8px 24px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .row {
            margin-bottom: 50px;
        }
        
        .row-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding: 0 4%;
        }
        
        .row-title {
            font-size: 1.4vw;
            font-weight: 700;
        }
        
        .row-more {
            color: #54b9c5;
            font-size: 0.8vw;
            cursor: pointer;
        }
        
        .row-content {
            display: flex;
            gap: 8px;
            padding: 0 4%;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .row-content::-webkit-scrollbar {
            display: none;
        }
        
        .card {
            min-width: 200px;
            height: 112px;
            border-radius: 4px;
            background: #2f2f2f;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 16px;
            cursor: pointer;
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: scale(1.05);
        }
        
        .card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30%;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
        }
        
        .card-title {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
            z-index: 1;
        }
        
        .card-info {
            font-size: 12px;
            color: #b3b3b3;
            z-index: 1;
        }
        
        /* Modal pour voir les détails d'un cours */
        .course-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .course-modal.active {
            display: flex;
        }
        
        .course-modal-content {
            background: #181818;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 8px;
            padding: 30px;
        }
        
        .course-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }
        
        .course-lists {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .list-item {
            background: #2f2f2f;
            padding: 20px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .list-item:hover {
            background: #3f3f3f;
        }
        
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1999;
            display: none;
        }
        
        .modal-backdrop.active {
            display: block;
        }
        
        /* Styles pour l'application flashcards */
        .app-container {
            display: none;
        }
        
        .app-container.active {
            display: block;
        }
        
        /* Dropdown profile */
        .profile-dropdown {
            position: absolute;
            top: 60px;
            right: 4%;
            background: rgba(0,0,0,0.9);
            border: 1px solid #333;
            border-radius: 4px;
            padding: 10px 0;
            min-width: 200px;
            display: none;
        }
        
        .profile-dropdown.active {
            display: block;
        }
        
        .profile-dropdown-item {
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .profile-dropdown-item:hover {
            background: #333;
        }
        
        /* Section utilisateurs publics */
        .public-users {
            margin-top: 30px;
        }
        
        .user-card {
            background: #2f2f2f;
            border-radius: 4px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
        }
        
        .user-card:hover {
            background: #3f3f3f;
        }
        
        .user-avatar-small {
            width: 50px;
            height: 50px;
            border-radius: 4px;
            background: #e50914;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .user-stats {
            font-size: 14px;
            color: #b3b3b3;
        }

        /* Reste des styles de l'application flashcards */
        :root {
            --bg-gradient-from: #667eea;
            --bg-gradient-to: #764ba2;
            --primary: #667eea;
            --primary-2: #764ba2;
            --accent: #11998e;
            --accent-2: #38ef7d;
            --danger: #ff6b6b;
            --text: #333333;
            --text-soft: #666666;
            --panel: #ffffff;
            --panel-muted: #f5f7fa;
            --border: #e0e0e0;
            --shadow: rgba(0,0,0,0.08);
            --card-bg: #ffffff;
            --card-grad-from: #f5f7fa;
            --card-grad-to: #c3cfe2;
            --known: #38ef7d;
            --partial: #f5a623;
            --unknown: #ff6b6b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-from) 0%, var(--bg-gradient-to) 100%);
            min-height: 100vh;
            color: var(--text);
        }
        
        .sidebar {
            width: 280px;
            background: var(--panel);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 100;
            transition: transform 0.3s ease;
            border-right: 1px solid var(--border);
        }
        .sidebar.hidden { transform: translateX(-280px); }
        
        .sidebar-header {
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);
            color: white;
        }
        .sidebar-header h1 { font-size: 22px; margin-bottom: 5px; }
        .sidebar-header p { font-size: 13px; opacity: 0.9; }
        
        .sidebar-nav { padding: 20px; border-bottom: 2px solid var(--border); }
        .nav-item { padding: 12px 15px; margin-bottom: 8px; border-radius: 8px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 10px; font-weight: 500; color: var(--text); }
        .nav-item:hover { background: var(--panel-muted); }
        .nav-item.active { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); color: white; }
        
        .folder-section { flex: 1; overflow-y: auto; padding: 20px; background: var(--panel); }
        .folder-section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .folder-section-header h3 { font-size: 14px; color: var(--text-soft); text-transform: uppercase; letter-spacing: 0.5px; }
        
        .btn-new-folder, .btn-new-category { background: var(--primary); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.3s; }
        .btn-new-folder:hover, .btn-new-category:hover { filter: brightness(90%); }
        .btn-new-category { background: var(--accent); }
        
        .category-item { margin-bottom: 10px; }
        .category-header { display: flex; align-items: center; justify-content: space-between; padding: 8px 10px; background: var(--panel-muted); border-radius: 6px; cursor: pointer; transition: all 0.3s; color: var(--text); }
        .category-header:hover { background: var(--border); }
        .category-header.active { background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%); color: white; }
        .category-left { display: flex; align-items: center; gap: 8px; flex: 1; }
        .category-toggle { font-size: 12px; transition: transform 0.3s; }
        .category-toggle.open { transform: rotate(90deg); }
        .category-name { font-weight: 600; font-size: 14px; }
        .category-count { background: rgba(0,0,0, 0.1); padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 600; color: inherit; margin-left: 5px; }
        .category-actions { display: flex; gap: 5px; opacity: 0; transition: all 0.3s; }
        .category-header:hover .category-actions { opacity: 1; }
        
        .btn-edit-category, .btn-delete-category { background: none; border: none; color: var(--text-soft); cursor: pointer; font-size: 14px; padding: 0; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        .category-header.active .btn-edit-category, .category-header.active .btn-delete-category { color: rgba(255, 255, 255, 0.8); }
        .btn-edit-category:hover { color: var(--primary); }
        .category-header.active .btn-edit-category:hover { color: white; }
        .btn-delete-category:hover { color: var(--danger); }
        
        .category-folders { padding-left: 15px; margin-top: 5px; display: none; }
        .category-folders.open { display: block; }
        
        .folder-item { padding: 10px 15px; margin-bottom: 5px; border-radius: 6px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: space-between; color: var(--text); }
        .folder-item:hover { background: var(--panel-muted); }
        .folder-item.active { background: var(--panel-muted); color: var(--primary); font-weight: 600; border: 1px solid var(--primary); }
        .folder-info { display: flex; align-items: center; gap: 8px; flex: 1; }
        .folder-badge { background: rgba(0,0,0, 0.05); padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 600; color: var(--text-soft); }
        .folder-item.active .folder-badge { background: rgba(102, 126, 234, 0.2); color: var(--primary); }
        .folder-actions { display: flex; gap: 5px; opacity: 0; transition: all 0.3s; }
        .folder-item:hover .folder-actions { opacity: 1; }
        .btn-edit-folder, .btn-delete-folder { background: none; border: none; color: var(--text-soft); cursor: pointer; font-size: 14px; padding: 0; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        .btn-edit-folder:hover { color: var(--primary); }
        .btn-delete-folder:hover { color: var(--danger); }
        
        .toggle-sidebar-btn { position: fixed; left: 290px; top: 20px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); border: none; color: white; width: 48px; height: 48px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; z-index: 101; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .toggle-sidebar-btn:hover { transform: translateY(-2px) scale(1.05); }
        .toggle-sidebar-btn.sidebar-hidden { left: 10px; background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%); }
        .toggle-icon { transition: transform 0.3s ease; display: inline-block; }
        .toggle-sidebar-btn.sidebar-hidden .toggle-icon { transform: rotate(180deg); }
        
        .main-content { margin-left: 280px; flex: 1; padding: 40px; overflow-y: auto; height: 100vh; transition: margin-left 0.3s ease; }
        .main-content.sidebar-hidden { margin-left: 0; }
        
        .container { background: var(--panel); border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); padding: 40px; max-width: 800px; margin: 0 auto; color: var(--text); }
        
        .app-header { background: var(--panel); border-radius: 20px 20px 0 0; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); padding: 20px 40px; max-width: 800px; margin: 0 auto 20px auto; display: flex; justify-content: space-between; align-items: center; }
        .app-header h1 { margin: 0; font-size: 22px; color: var(--text); }
        .app-header p { margin: 0; font-size: 13px; color: var(--text-soft); }
        
        .btn-comparator { background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%); color: white; border: none; border-radius: 8px; padding: 10px 16px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s; margin-left: 10px; }
        .btn-comparator:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        .home-page { text-align: center; }
        .home-hero { padding: 60px 40px; }
        .home-hero h1 { font-size: 48px; color: var(--text); margin-bottom: 20px; }
        .home-hero p { font-size: 18px; color: var(--text-soft); line-height: 1.6; margin-bottom: 10px; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 40px; }
        .stat-card { background: linear-gradient(135deg, var(--panel-muted) 0%, #e0e7ff 100%); padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .stat-card-value { font-size: 36px; font-weight: 700; color: var(--primary); margin-bottom: 10px; }
        .stat-card-label { font-size: 14px; color: var(--text-soft); font-weight: 500; }
        
        .quick-actions { margin-top: 40px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .btn-action { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); color: white; padding: 15px 30px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-action:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-action-secondary { background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%); }
        .btn-export-all { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: #111; border: none; border-radius: 10px; padding: 15px 30px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s; }
        .btn-export-all:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        .recent-courses { margin-top: 50px; text-align: left; }
        .recent-courses h2 { font-size: 24px; color: var(--text); margin-bottom: 20px; }
        .course-list { display: flex; flex-direction: column; gap: 15px; }
        .course-card { background: var(--panel-muted); padding: 20px; border-radius: 12px; cursor: pointer; transition: all 0.3s; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border); }
        .course-card:hover { background: #e8ebff; transform: translateX(5px); }
        .course-card-left { flex: 1; }
        .course-card-title { font-size: 18px; font-weight: 600; color: var(--text); margin-bottom: 5px; }
        .course-card-info { font-size: 14px; color: var(--text-soft); }
        .course-card-arrow { font-size: 24px; color: var(--primary); }
        
        .lists-page h2 { color: var(--text); margin-bottom: 10px; font-size: 28px; display: inline-block; }
        .lists-page-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .btn-edit-page-title { background: none; border: none; color: var(--primary); cursor: pointer; font-size: 20px; padding: 5px; transition: all 0.3s; }
        .lists-page-subtitle { color: var(--text-soft); font-size: 14px; margin-bottom: 30px; }
        .lists-grid { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; }
        .list-card { background: linear-gradient(135deg, var(--panel-muted) 0%, #e0e7ff 100%); padding: 25px 30px; border-radius: 15px; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); position: relative; display: flex; justify-content: space-between; align-items: center; }
        .list-card:hover { transform: translateX(5px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); }
        .list-card-left { flex: 1; }
        .list-card-title { font-size: 22px; font-weight: 600; color: var(--text); margin-bottom: 8px; }
        .list-card-count { font-size: 14px; color: var(--text-soft); margin-bottom: 5px; }
        .list-card-progress { font-size: 13px; color: var(--primary); font-weight: 600; }
        .list-card-actions { display: flex; gap: 12px; }
        .btn-list-action { padding: 15px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; color: white; min-width: 140px; }
        .btn-study { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); }
        .btn-manage { background: linear-gradient(135deg, var(--partial) 0%, #f7b733 100%); }
        .list-card-buttons { position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; opacity: 0; transition: all 0.3s; }
        .list-card:hover .list-card-buttons { opacity: 1; }
        .btn-edit-list, .btn-delete-list, .btn-embed { background: rgba(255, 255, 255, 0.9); border: none; color: var(--primary); cursor: pointer; font-size: 11px; padding: 4px 7px; border-radius: 3px; transition: all 0.3s; line-height: 1; }
        .btn-edit-list:hover, .btn-embed:hover { background: var(--primary); color: white; }
        .btn-delete-list { color: var(--danger); }
        .btn-delete-list:hover { background: var(--danger); color: white; }
        .btn-new-list { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); color: white; padding: 15px 30px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; width: 100%; }
        
        .manage-cards-page h2 { color: var(--text); margin-bottom: 10px; font-size: 28px; }
        .breadcrumb { color: var(--text-soft); font-size: 14px; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }
        .breadcrumb a { color: var(--primary); text-decoration: none; cursor: pointer; }
        .manage-section { margin-bottom: 40px; }
        .manage-section h3 { font-size: 20px; color: var(--text); margin-bottom: 15px; }
        .cards-list { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
        .card-edit-item { background: var(--panel-muted); padding: 20px; border-radius: 12px; border: 2px solid transparent; transition: all 0.3s; }
        .card-edit-item:hover { border-color: var(--primary); }
        .card-edit-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .card-edit-number { font-size: 14px; font-weight: 600; color: var(--primary); }
        .btn-delete-card { background: var(--danger); color: white; padding: 5px 12px; border: none; border-radius: 5px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-edit-card { background: var(--primary); color: white; padding: 5px 12px; border: none; border-radius: 5px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .card-inline-editor { margin-top: 12px; padding: 14px; border: 2px dashed var(--border); border-radius: 10px; background: var(--panel); }
        .card-inline-editor .actions { display: flex; gap: 8px; margin-top: 10px; }
        .btn-save-card { background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%); color: #fff; border: none; border-radius: 6px; padding: 8px 14px; font-weight: 700; cursor: pointer; }
        .btn-cancel-card { background: var(--border); color: var(--text); border: none; border-radius: 6px; padding: 8px 14px; font-weight: 700; cursor: pointer; }
        .btn-edit-current { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); color: #fff; border: none; border-radius: 8px; padding: 10px 16px; font-weight: 700; cursor: pointer; }
        
        .card-edit-content { display: flex; flex-direction: column; gap: 10px; }
        .card-edit-text { font-size: 14px; color: var(--text); }
        .card-edit-label { font-weight: 600; color: var(--text-soft); margin-right: 5px; }
        .editor-toolbar {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            padding: 8px;
            background: var(--panel-muted);
            border-radius: 8px;
            border: 1px solid var(--border);
            align-items: center;
        }
        .editor-btn{
            font-size: 12px !important;
            padding: 4px 8px !important;
            border-width: 1px !important;
            line-height: 1 !important;
            min-width: 0 !important;
            min-height: 0 !important;
        }
        .editor-btn:hover { background: var(--primary); color: white; }
        .editor-content { width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 14px; font-family: inherit; min-height: 120px; resize: vertical; overflow-y: auto; background: var(--panel); color: var(--text); }
        .editor-content:focus { outline: none; border-color: var(--primary); }
        .empty-cards-message { text-align: center; padding: 40px; color: var(--text-soft); font-size: 16px; }
        
        .study-page h2 { color: var(--text); margin-bottom: 20px; font-size: 28px; }
        .study-mode-indicator { display: inline-block; background: var(--partial); color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; margin-left: 10px; }
        .study-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .progress-bar { background: var(--border); height: 8px; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { background: linear-gradient(90deg, var(--primary), var(--primary-2)); height: 100%; transition: width 0.3s ease; }
        
        .card-container { perspective: 1000px; margin-bottom: 30px; }
        .card { background: transparent; border-radius: 15px; min-height: 300px; max-height: 500px; cursor: pointer; transition: transform 0.6s; transform-style: preserve-3d; position: relative; }
        .card.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; padding: 40px; overflow-y: auto; overflow-x: hidden; background: var(--card-bg); border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); border: 1px solid var(--border); color: var(--text); }
        .card-back { transform: rotateY(180deg); }
        .card-text { font-size: 24px; color: var(--text); font-weight: 500; line-height: 1.5; width: 100%; text-align: center; }
        .card-text img { max-width: 100%; height: auto; display: inline-block; margin: 5px; border-radius: 8px; vertical-align: middle; }
        
        .buttons { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        button { padding: 15px 30px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; color: white; flex: 1; min-width: 150px; }
        .btn-known { background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%); }
        .btn-partial { background: linear-gradient(135deg, var(--partial) 0%, #f7b733 100%); }
        .btn-unknown { background: linear-gradient(135deg, var(--danger) 0%, #ee5a6f 100%); }
        .stats { text-align: center; margin-top: 20px; color: var(--text-soft); font-size: 14px; }
        .flip-hint { text-align: center; color: var(--text-soft); font-size: 14px; margin-bottom: 20px; font-style: italic; }
        
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; color: var(--text); font-weight: 600; }
        .input-group input[type="text"], .input-group input[type="color"] {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            background: var(--panel);
            color: var(--text);
            box-sizing: border-box;
        }
        .input-group input[type="text"]:focus { outline: none; border-color: var(--primary); }
        .input-group select {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            background: var(--panel);
            color: var(--text);
            box-sizing: border-box;
            cursor: pointer;
        }
        .btn-add { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); width: 100%; margin-top: 10px; }
        
        .end-message { text-align: center; padding: 40px; background: var(--panel); border: 1px solid var(--border); border-radius: 12px; }
        .end-message h2 { color: var(--text); margin-bottom: 30px; }
        
        .stat-bar-track { width: 100%; height: 30px; background: var(--panel-muted); border-radius: 8px; overflow: hidden; border: 1px solid var(--border); }
        .stat-bar-fill-known { background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%); }
        .stat-bar-fill-partial { background: linear-gradient(135deg, var(--partial) 0%, #f7b733 100%); }
        .stat-bar-fill-unknown { background: linear-gradient(135deg, var(--danger) 0%, #ee5a6f 100%); }
        .legend-known { background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%); }
        .legend-partial { background: linear-gradient(135deg, var(--partial) 0%, #f7b733 100%); }
        .legend-unknown { background: linear-gradient(135deg, var(--danger) 0%, #ee5a6f 100%); }
        
        .btn-restart { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); }
        .btn-review { background: linear-gradient(135deg, var(--partial) 0%, #f7b733 100%); }
        .btn-next-list { background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%); }
        .btn-export { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .btn-clear { background: linear-gradient(135deg, var(--danger) 0%, #ee5a6f 100%); }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-content { background: var(--panel); padding: 30px; border-radius: 15px; max-width: 400px; width: 90%; position: relative; z-index: 1001; color: var(--text); }
        .modal-header { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: var(--text); }
        .btn-cancel { background: var(--border); color: var(--text); }
        .btn-cancel:hover { filter: brightness(90%); }
        
        .page { display: none; }
        .page.active { display: block; }
        #fileInput, #imageInput { display: none; }
        
        /* THÈME MODAL */
        #themeModal { z-index: 3000; }
        #themeModal .modal-content { 
            max-width: 700px; 
            max-height: 90vh; 
            overflow-y: auto;
            padding: 25px;
        }
        
        .theme-section {
            margin-bottom: 25px;
            padding: 20px;
            background: var(--panel-muted);
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        
        .theme-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .color-option {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .color-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-soft);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .color-preview {
            width: 100%;
            height: 40px;
            border-radius: 8px;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .color-preview:hover {
            transform: scale(1.05);
        }
        
        .color-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .color-input-wrapper input[type="color"] {
            width: 50px;
            height: 40px;
            border: 2px solid var(--border);
            border-radius: 6px;
            padding: 0;
            cursor: pointer;
            background: var(--panel);
        }
        
        .color-input-wrapper input[type="text"] {
            flex: 1;
            padding: 8px 10px;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            font-family: monospace;
            background: var(--panel);
            color: var(--text);
        }
        
        .presets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .preset-btn {
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: var(--panel);
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .preset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }
        
        .preset-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .preset-preview {
            width: 100%;
            height: 60px;
            border-radius: 6px;
            margin-bottom: 5px;
        }
        
        .theme-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        
        .theme-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .theme-btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);
            color: white;
        }
        
        .theme-btn-secondary {
            background: var(--border);
            color: var(--text);
        }
        
        .theme-btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #ee5a6f 100%);
            color: white;
        }
        
        .theme-btn-success {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
            color: white;
        }
        
        .live-preview {
            margin-top: 20px;
            padding: 15px;
            background: var(--panel);
            border-radius: 10px;
            border: 2px solid var(--border);
        }
        
        .live-preview h4 {
            margin: 0 0 10px 0;
            color: var(--text);
            font-size: 16px;
        }
        
        .preview-elements {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .preview-element {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
        }
       
        /* COMPARATOR STYLES */
        #comparatorModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; overflow: auto; }
        #comparatorModal.show { display: block; }
        .comparator-container { background: #0b0c0f; color: #e8ecf3; min-height: 100vh; padding: 20px; }
        .comparator-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #23262d; background: #14161a; margin-bottom: 20px; border-radius: 10px; }
        .btn-close-comparator { background: #ff6b6b; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .comparator-main { display: grid; grid-template-columns: 1fr 360px; gap: 20px; }
        .comparator-aside { background: #14161a; border-radius: 12px; padding: 16px; }
        .comp-panel { background: #14161a; border: 1px solid #23262d; border-radius: 12px; overflow: hidden; margin-bottom: 20px; }
        .comp-panel h2 { margin: 0; padding: 12px 14px; border-bottom: 1px solid #23262d; font-size: 16px; }
        #diffOutput { padding: 14px; white-space: pre-wrap; word-break: break-word; }
        .comp-controls { display: grid; gap: 12px; padding: 12px; border: 1px solid #23262d; background: #14161a; border-radius: 12px; }
        .comp-controls textarea { width: 100%; min-height: 120px; resize: vertical; background: #0e1014; border: 1px solid #2a2f39; border-radius: 8px; color: #e8ecf3; padding: 10px; font-family: inherit; }
        .comp-controls label { font-weight: 600; margin-bottom: 6px; display: block; color: #e8ecf3; }
        .comp-controls button { background: #5b8cff; color: white; border: 0; border-radius: 8px; padding: 10px 12px; font-weight: 600; cursor: pointer; }
        .comp-controls button.secondary { background: #2a2f39; }
        .comp-split { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        mark.ins, mark.del { background: transparent; border-radius: 4px; color: #fff; padding: 0 2px; border: 1px solid; }
        mark.ins { box-shadow: inset 0 -0.45em rgba(31,191,71,0.4); border-color: rgba(31,191,71,0.7); }
        mark.del { box-shadow: inset 0 -0.45em rgba(255,92,92,0.35); border-color: rgba(255,92,92,0.7); text-decoration: line-through; }
        mark.focused { box-shadow: inset 0 -0.48em rgba(255,209,102,0.9), 0 0 0 2px rgba(255,209,102,0.25) !important; border-color: rgba(255,209,102,0.85) !important; background: rgba(255,209,102,0.2) !important; }
        .comp-change.selected { border-color: #ffd166 !important; box-shadow: 0 0 0 2px rgba(255,209,102,0.25) !important; background: rgba(255,209,102,0.1); }
        .comp-summary { padding: 12px; border-bottom: 1px solid #23262d; }
        .comp-change { display: block; text-align: left; width: 100%; background: transparent; border: 1px solid #2a2f39; border-radius: 10px; color: #e8ecf3; padding: 10px; margin: 8px 0; cursor: pointer; }
        .comp-change:hover { border-color: #ffd166; }
        .comp-change.selected { border-color: #ffd166; box-shadow: 0 0 0 2px rgba(255,209,102,0.25); }
        .comp-change .type { font-weight: 700; margin-bottom: 6px; display: block; }
        .comp-change .token { display: inline; color: #fff; padding: 0 1px; border-radius: 4px; border: 1px solid; }
        .comp-change .token { box-shadow: inset 0 -0.35em rgba(31,191,71,0.4); border-color: rgba(31,191,71,0.7); }
        .comp-change .token.del { box-shadow: inset 0 -0.35em rgba(255,92,92,0.35); border-color: rgba(255,92,92,0.7); text-decoration: none; }
        .comp-change .ctx { color: #8b93a6; display: block; margin-top: 6px; font-size: 12px; }
        #backToSelected { position: fixed; right: 390px; bottom: 20px; z-index: 2001; background: #ffd166; color: #111; border: 0; border-radius: 999px; padding: 10px 14px; font-weight: 800; cursor: pointer; box-shadow: 0 6px 18px rgba(0,0,0,0.35); display: none; }
        #backToSelected.visible { display: inline-flex; }
        #backToSelected:hover { filter: brightness(0.95); }
        .del-ghost { display: inline-block; margin: 0 2px; color: #fff; }
        .del-ghost mark.del { text-decoration: none; box-shadow: inset 0 -0.45em rgba(255,92,92,0.35); border-color: rgba(255,92,92,0.7); }
        .focus-ghost { display: inline-block; width: 10px; height: 1.2em; vertical-align: baseline; box-shadow: inset 0 -0.48em rgba(255,209,102,0.9), 0 0 0 2px rgba(255,209,102,0.25); border: 1px dashed rgba(255,209,102,0.85); border-radius: 4px; }
        .comp-change .token { box-shadow: inset 0 -0.35em rgba(34,197,94,0.7); border-color: rgba(34,197,94,1); background: rgba(34,197,94,0.15); }
        mark.ins { box-shadow: inset 0 -0.45em rgba(34,197,94,0.6); border-color: rgba(34,197,94,0.9); }
        @media (max-width: 1000px) { .comparator-main { grid-template-columns: 1fr; } #backToSelected { right: 12px; bottom: 12px; } }
        .btn-filter-del { background: #2a2f39; color: #e8ecf3; border: 0; border-radius: 8px; padding: 8px 10px; font-weight: 700; cursor: pointer; }
        .btn-filter-del.active { background: #ff6b6b; color: #fff; }
        
        /* GIF de félicitations */
        .result-gif {
            display: none;
            margin-top: 20px;
            text-align: center;
        }
        .result-gif img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }
        .result-gif.show { display: block; }
       
        /* Styles pour les badges d'importance */
        .card-importance-header {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 10;
            pointer-events: none;
            opacity: 0.8;
            transition: opacity 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .card-importance-header.important { background: #10b981; color: white; }
        .card-importance-header.normal { background: #3b82f6; color: white; }
        .card-importance-header.pas-important { background: #ef4444; color: white; }
        .card-importance-header.explication { background: #6b7280; color: white; }

        .card:hover .card-importance-header {
            opacity: 1;
        }
        
        /* Contrôles de filtrage par importance */
        .filter-controls {
            background: var(--panel-muted);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .filter-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-soft);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-btn.active {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .filter-btn.important { background: #10b98120; color: #10b981; border-color: #10b981; }
        .filter-btn.normal { background: #3b82f620; color: #3b82f6; border-color: #3b82f6; }
        .filter-btn.pas-important { background: #ef444420; color: #ef4444; border-color: #ef4444; }
        .filter-btn.explication { background: #6b728020; color: #6b7280; border-color: #6b7280; }

        .filter-btn.active.important { background: #10b981; color: white; }
        .filter-btn.active.normal { background: #3b82f6; color: white; }
        .filter-btn.active.pas-important { background: #ef4444; color: white; }
        .filter-btn.active.explication { background: #6b7280; color: white; }

        .filter-btn .count {
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            min-width: 24px;
            text-align: center;
        }

        .filter-btn.active .count {
            background: rgba(255,255,255,0.3);
        }

        /* Indicateur de filtrage actif */
        .filter-indicator {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }
        
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            overflow-y: auto;
            overflow-x: hidden;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            color: var(--text);
        }

        /* Ajustement du padding pour laisser de la place au badge */
        .card-front {
            padding-top: 60px !important;
        }
        
        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        /* Options de filtrage dans le mode révision */
        .review-options {
            background: var(--panel-muted);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid var(--border);
        }

        .review-options h4 {
            font-size: 14px;
            margin-bottom: 8px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Styles pour la section utilisateur */
        .user-section {
            padding: 20px;
            border-bottom: 2px solid var(--border);
            background: var(--panel-muted);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            cursor: pointer;
        }
        
        .user-info:hover {
            opacity: 0.9;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
            overflow: hidden;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-details {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            color: var(--text);
            font-size: 16px;
        }
        
        .user-status {
            font-size: 12px;
            color: var(--text-soft);
        }
        
        .user-search {
            margin-top: 15px;
        }
        
        .user-search input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--panel);
            color: var(--text);
        }
        
        .user-search-results {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--panel);
        }
        
        .user-result {
            padding: 10px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-result:hover {
            background: var(--panel-muted);
        }
        
        .user-result-avatar {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            overflow: hidden;
            border: 2px solid white;
        }
        
        .user-result-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-result-info {
            flex: 1;
        }
        
        .user-result-name {
            font-weight: 600;
            font-size: 14px;
        }
        
        .user-result-stats {
            font-size: 11px;
            color: var(--text-soft);
        }
        
        .logout-btn {
            width: 100%;
            padding: 10px;
            background: var(--border);
            color: var(--text);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: var(--danger);
            color: white;
        }
        
        .public-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-soft);
        }
        
        .public-toggle input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        /* Modal paramètres utilisateur */
        .profile-settings-modal .modal-content {
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
        }
        
        .profile-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .profile-form .input-group {
            margin-bottom: 8px;
        }

        .profile-form .input-group label {
            font-size: 13px;
            margin-bottom: 4px;
        }

        .profile-form .input-group input,
        .profile-form .input-group textarea {
            padding: 8px 10px;
            font-size: 14px;
            border-radius: 6px;
            border: 2px solid var(--border);
            width: 100%;
        }

        .profile-form .input-group textarea {
            min-height: 60px;
            resize: vertical;
        }
        
        .avatar-upload {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            font-weight: bold;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            position: relative;
        }
        
        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .avatar-preview:hover::after {
            content: '📷';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }
        
        .avatar-upload input {
            display: none;
        }
        
        .profile-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .danger-zone {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--danger);
        }
        
        .danger-zone h4 {
            color: var(--danger);
            margin-bottom: 10px;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #ee5a6f 100%);
            color: white;
        }
        
        /* Message de notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            font-weight: 600;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, var(--danger) 0%, #ee5a6f 100%);
        }
        
        /* Styles pour le mode plein écran */
        .fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, var(--bg-gradient-from) 0%, var(--bg-gradient-to) 100%);
            z-index: 10000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .fullscreen-mode.active {
            display: flex;
        }

        .fullscreen-card-container {
            width: 90%;
            height: 80%;
            perspective: 1000px;
        }

        .fullscreen-card {
            width: 100%;
            height: 100%;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.8s;
            transform-style: preserve-3d;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .fullscreen-card.flipped {
            transform: rotateY(180deg);
        }

        .fullscreen-card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px;
            overflow-y: auto;
            border-radius: 20px;
        }

        .fullscreen-card-front {
            background: var(--card-bg);
        }

        .fullscreen-card-back {
            background: var(--card-bg);
            transform: rotateY(180deg);
        }

        .fullscreen-card-text {
            font-size: 28px;
            line-height: 1.6;
            color: var(--text);
            text-align: center;
            width: 100%;
        }

        .fullscreen-card-text img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 10px 0;
        }

        .fullscreen-controls {
            position: absolute;
            bottom: 30px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 15px;
            z-index: 10001;
        }

        .fullscreen-btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            min-width: 140px;
        }

        .fullscreen-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-close-btn:hover {
            background: rgba(0,0,0,0.7);
        }
        
        .btn-fullscreen {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-fullscreen:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <!-- PAGE D'AUTHENTIFICATION STYLE NETFLIX -->
    <div id="authPage" class="auth-page">
        <div class="auth-container">
            <div class="auth-header">
                <h1>📚 Flashcards+</h1>
                <p>Système d'apprentissage collaboratif</p>
            </div>
            
            <div id="authError" class="auth-error" style="display:none"></div>
            <div id="authSuccess" class="auth-success" style="display:none"></div>
            
            <div id="loginForm" class="auth-form">
                <h2 style="color: white; margin-bottom: 20px;">Connexion</h2>
                <div class="auth-input-group">
                    <input type="text" id="loginUsername" placeholder="Nom d'utilisateur">
                </div>
                <div class="auth-input-group">
                    <input type="password" id="loginPassword" placeholder="Mot de passe">
                </div>
                <button class="auth-button" onclick="login()">Se connecter</button>
                
                <div class="auth-toggle">
                    Nouveau sur Flashcards+ ? <a onclick="showRegister()">Inscrivez-vous maintenant.</a>
                </div>
                
                <button class="guest-button" onclick="loginAsGuest()">
                    Continuer en tant qu'invité
                </button>
            </div>
            
            <div id="registerForm" class="auth-form" style="display: none;">
                <h2 style="color: white; margin-bottom: 20px;">Inscription</h2>
                <div class="auth-input-group">
                    <input type="text" id="registerUsername" placeholder="Choisissez un nom d'utilisateur">
                </div>
                <div class="auth-input-group">
                    <input type="email" id="registerEmail" placeholder="Email (optionnel)">
                </div>
                <div class="auth-input-group">
                    <input type="password" id="registerPassword" placeholder="Choisissez un mot de passe">
                </div>
                <div class="auth-input-group">
                    <input type="password" id="registerConfirmPassword" placeholder="Confirmez le mot de passe">
                </div>
                <button class="auth-button" onclick="register()">S'inscrire</button>
                
                <div class="auth-toggle">
                    Déjà un compte ? <a onclick="showLogin()">Connectez-vous.</a>
                </div>
            </div>
        </div>
    </div>

    <!-- PAGE D'ACCUEIL APRÈS CONNEXION -->
    <div id="homepage" class="homepage" style="display: none;">
        <div class="navbar">
            <div class="navbar-brand">📚 Flashcards+</div>
            <div class="nav-links">
                <a href="#" onclick="showApp()">Mes Cours</a>
                <a href="#" onclick="showPublicUsers()">Utilisateurs Publics</a>
                <div class="nav-profile" onclick="toggleProfileDropdown()">
                    <div class="profile-avatar" id="homeAvatar">U</div>
                    <span id="homeUsername">Utilisateur</span>
                </div>
            </div>
            
            <div class="profile-dropdown" id="profileDropdown">
                <div class="profile-dropdown-item" onclick="openProfileSettings()">
                    <span>⚙️</span>
                    <span>Paramètres</span>
                </div>
                <div class="profile-dropdown-item" onclick="logout()">
                    <span>🚪</span>
                    <span>Déconnexion</span>
                </div>
            </div>
        </div>
        
        <div class="hero">
            <h1>Bienvenue, <span id="heroUsername">Utilisateur</span> !</h1>
            <p>Apprenez, révisez et partagez vos connaissances avec le système de flashcards collaboratif.</p>
            <div class="hero-buttons">
                <button class="btn-play" onclick="showApp()">
                    <span>▶</span>
                    <span>Continuer vers mes cours</span>
                </button>
                <button class="btn-info" onclick="showPublicUsers()">
                    <span>ℹ️</span>
                    <span>Découvrir les fiches publiques</span>
                </button>
            </div>
        </div>
        
        <div class="row">
            <div class="row-header">
                <div class="row-title">Mes Cours Récents</div>
                <div class="row-more" onclick="showApp()">Voir tout</div>
            </div>
            <div class="row-content" id="recentCourses"></div>
        </div>
        
        <div class="row">
            <div class="row-header">
                <div class="row-title">Cours Publics Populaires</div>
                <div class="row-more" onclick="showPublicUsers()">Explorer</div>
            </div>
            <div class="row-content" id="publicCourses"></div>
        </div>
    </div>

    <!-- APPLICATION PRINCIPALE FLASHCARDS -->
    <div id="appContent" style="display:none;">
        <button class="toggle-sidebar-btn" id="toggleSidebarBtn" onclick="toggleSidebar()"><span class="toggle-icon">◀</span></button>
        <div class="sidebar" id="sidebar">
            <!-- Section utilisateur -->
            <div class="user-section">
                <div class="user-info" onclick="openProfileSettings()">
                    <div class="user-avatar" id="userAvatar">
                        <!-- L'image sera ajoutée dynamiquement -->
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Utilisateur</div>
                        <div class="user-status" id="userStatus">Membre</div>
                    </div>
                </div>
                
                <div class="public-toggle">
                    <input type="checkbox" id="publicProfileToggle" onchange="togglePublicProfile()">
                    <label for="publicProfileToggle">Profil public</label>
                </div>
                
                <div class="user-search">
                    <input type="text" id="userSearchInput" placeholder="🔍 Rechercher un utilisateur..." 
                           oninput="searchUsers()">
                    <div class="user-search-results" id="userSearchResults"></div>
                </div>
                
                <button class="logout-btn" onclick="logout()">Déconnexion</button>
            </div>
            
            <div class="sidebar-nav">
                <div class="nav-item active" onclick="showPage('home')"><span>🏠</span><span>Accueil</span></div>
                <div class="nav-item" onclick="showPublicUsers()"><span>👥</span><span>Utilisateurs Publics</span></div>
            </div>
            <div class="folder-section">
                <div class="folder-section-header">
                    <h3>Organisation</h3>
                    <div class="folder-section-buttons">
                        <button class="btn-new-category" onclick="showNewCategoryModal()" title="Nouvelle catégorie">📁</button>
                        <button class="btn-new-folder" onclick="showNewFolderModal()" title="Nouveau cours">+</button>
                    </div>
                </div>
                <div id="categoryList"></div>
            </div>
        </div>
        <div class="main-content" id="mainContent">
            <div class="app-header" style="padding:10px 40px;">
                <button class="btn-comparator" onclick="openComparator()">
                    🔍 Comparateur de texte
                </button>
                <button class="btn-comparator" onclick="openThemeModal()">🎨 Personnaliser le thème</button>
            </div>
            <div id="homePage" class="page active">
                <div class="container home-page">
                    <div class="home-hero"><h1>Bienvenue ! 👋</h1><p>Apprends efficacement avec ton système de flashcards.</p></div>
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-card-value" id="totalCourses">0</div><div class="stat-card-label">Cours créés</div></div>
                        <div class="stat-card"><div class="stat-card-value" id="totalCards">0</div><div class="stat-card-label">Cartes totales</div></div>
                    </div>
                    <div class="quick-actions">
                        <button class="btn-action" onclick="showNewFolderModal()">➕ Créer un cours</button>
                        <button class="btn-action btn-action-secondary" onclick="importCards()">📥 Importer</button>
                        <button class="btn-export-all" onclick="exportAll()">📦 Exporter tout</button>
                    </div>
                    <div class="recent-courses"><h2>Mes cours</h2><div class="course-list" id="courseList"></div></div>
                </div>
            </div>
            <div id="listsPage" class="page">
                <div class="container lists-page">
                    <div class="lists-page-header"><h2 id="listsTitle">Cours</h2><button class="btn-edit-page-title" onclick="showRenameFolderModal()">✏️</button><button class="btn-edit-page-title" title="Intégrer ce cours" onclick="copyFolderEmbed()">🔗</button></div>
                    <p class="lists-page-subtitle">Sélectionne une liste à réviser</p>
                    <div class="lists-grid" id="listsGrid"></div>
                    <button class="btn-new-list" onclick="showNewListModal()">➕ Créer une nouvelle liste</button>
                </div>
            </div>
            <div id="manageCardsPage" class="page">
                <div class="container manage-cards-page">
                    <div class="breadcrumb"><a id="backToLists">← Retour aux listes</a></div>
                    <h2 id="manageTitle">Gérer les cartes</h2>
                    
                    <div class="manage-section">
                        <div style="display: grid; grid-template-columns: 1fr 110px; gap: 15px; margin-bottom: 25px;">
                            <div>
                                <h3 style="margin-bottom: 12px; color: var(--text); font-size: 15px;">Ajouter une carte</h3>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                                    <div class="input-group">
                                        <div style="display: flex; align-items: center; margin-bottom: 4px;">
                                            <div style="background: var(--primary); color: white; width: 18px; height: 18px; border-radius: 9px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; margin-right: 5px;">1</div>
                                            <label style="font-weight: 600; color: var(--text); font-size: 13px;">TERME</label>
                                        </div>
                                        <div class="editor-content" id="newQuestion" contenteditable="true" style="height: 100px; border: 1px solid var(--border); border-radius: 6px; padding: 8px; font-size: 13px; background: var(--panel); overflow-y: auto; resize: vertical; line-height: 1.4;"></div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <div style="display: flex; align-items: center; margin-bottom: 4px;">
                                            <div style="background: var(--primary); color: white; width: 18px; height: 18px; border-radius: 9px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; margin-right: 5px;">2</div>
                                            <label style="font-weight: 600; color: var(--text); font-size: 13px;">DÉFINITION</label>
                                        </div>
                                        <div class="editor-content" id="newAnswer" contenteditable="true" style="height: 100px; border: 1px solid var(--border); border-radius: 6px; padding: 8px; font-size: 13px; background: var(--panel); overflow-y: auto; resize: vertical; line-height: 1.4;"></div>
                                    </div>
                                </div>
                                
                                <button class="btn-add" onclick="addCard()" style="margin-top: 8px; padding: 8px 20px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); color: white; border: none; border-radius: 5px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px;">
                                    <span>➕</span>
                                    <span>Ajouter la carte</span>
                                </button>
                            </div>
                            
                            <div>
                                <div style="background: var(--panel-muted); padding: 8px; border-radius: 6px; border: 1px solid var(--border); display: flex; flex-direction: column; gap: 4px;">
                                    <div style="font-size: 11px; color: var(--text-soft); font-weight: 600; text-align: center; margin-bottom: 2px; text-transform: uppercase;">
                                        FORMAT
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; margin-bottom: 4px;">
                                        <button class="editor-btn" onclick="execFormatCommand('bold')" title="Gras" aria-label="Gras"><b>G</b></button>
                                        <button class="editor-btn" onclick="execFormatCommand('italic')" title="Italique" aria-label="Italique"><i>I</i></button>
                                        <button class="editor-btn" onclick="execFormatCommand('underline')" title="Souligné" aria-label="Souligné"><u>S</u></button>
                                    </div>
                                    
                                    <div style="margin-bottom: 4px;">
                                        <div style="font-size: 9px; color: var(--text-soft); margin-bottom: 2px; text-align: center;">Couleurs</div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px;">
                                            <div>
                                                <div style="font-size: 8px; color: var(--text-soft); margin-bottom: 1px; text-align: center;">Texte</div>
                                                <input type="color" id="textColorPicker" value="#000000" title="Couleur du texte" style="width: 100%; height: 22px; border: 1px solid var(--border); border-radius: 2px; cursor: pointer; padding: 0;" onchange="applyColorToSelection('foreColor', this.value)">
                                            </div>
                                            <div>
                                                <div style="font-size: 8px; color: var(--text-soft); margin-bottom: 1px; text-align: center;">Fond</div>
                                                <input type="color" id="bgColorPicker" value="#ffff00" title="Couleur de fond" style="width: 100%; height: 22px; border: 1px solid var(--border); border-radius: 2px; cursor: pointer; padding: 0;" onchange="applyColorToSelection('backColor', this.value)">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style="margin-bottom: 4px;">
                                        <div style="font-size: 9px; color: var(--text-soft); margin-bottom: 2px; text-align: center;">Importance</div>
                                        <select id="importanceSelect" style="width: 100%; padding: 3px 4px; border: 1px solid var(--border); border-radius: 2px; font-size: 10px; background: var(--panel); cursor: pointer; height: 22px;">
                                            <option value="important">Important</option>
                                            <option value="normal" selected>Normal</option>
                                            <option value="pas important">Pas important</option>
                                            <option value="explication">Explication</option>
                                        </select>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px; margin-top: 2px;">
                                        <button class="editor-btn" onclick="insertImage()" style="padding: 3px; font-size: 9px; height: 22px; display: flex; align-items: center; justify-content: center; gap: 2px; border: 1px solid var(--border); border-radius: 2px; background: var(--panel);">
                                            <span>🖼️</span>
                                            <span style="font-size: 8px;">Image</span>
                                        </button>
                                        <button class="editor-btn" onclick="clearFormatNow()" title="Effacer la mise en forme" aria-label="Effacer la mise en forme">✖</button>
                                    </div>
                                    
                                    <div style="margin-top: 4px; padding: 3px; background: var(--panel); border-radius: 2px; border: 1px dashed var(--border);">
                                        <p style="font-size: 7px; color: var(--text-soft); text-align: center; line-height: 1.1; margin: 0;">
                                            Sélectionnez du texte<br>puis cliquez
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="manage-section">
                        <h3 style="margin-bottom: 10px; color: var(--text); font-size: 15px;">📋 Cartes existantes (<span id="cardCount">0</span>)</h3>
                        <div class="cards-list" id="cardsList"></div>
                    </div>
                    
                    <div class="save-section" style="margin-top: 25px; padding-top: 12px; border-top: 1px solid var(--border);">
                        <h2 style="margin-bottom:10px;color:var(--text); font-size: 15px;">💾 Gestion des cartes</h2>
                        <div class="save-buttons" style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="btn-export" onclick="exportCards()" style="padding: 6px 12px; font-size: 12px; border-radius: 3px; height: 30px;">📥 Exporter</button>
                            <button class="btn-clear" onclick="clearCurrentList()" style="padding: 6px 12px; font-size: 12px; border-radius: 3px; height: 30px;">🗑️ Vider</button>
                            <button class="btn-action" onclick="importCards()" style="padding: 6px 12px; font-size: 12px; border-radius: 3px; height: 30px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);">📥 Importer JSON</button>
                            <button class="btn-action btn-action-secondary" onclick="showImportTextModal()" style="padding: 6px 12px; font-size: 12px; border-radius: 3px; height: 30px;">📋 Importer Texte/CSV</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="studyPage" class="page">
                <div class="container study-page">
                    <div class="breadcrumb"><a id="backToListsStudy">← Retour aux listes</a></div>
                    <div class="study-controls"> 
                        <div> 
                            <h2 id="studyTitle" style="display:inline">Liste</h2> 
                            <span id="studyModeIndicator" class="study-mode-indicator" style="display:none">🔄 Mode révision</span> 
                        </div> 
                        <div>
                            <button class="btn-edit-current" id="btnEditCurrent" onclick="editCurrentCard()">✏️ Éditer cette carte</button>
                            <button class="btn-fullscreen" onclick="openFullscreenStudy()">⛶ Plein écran</button>
                        </div>
                    </div>
                    <div id="cardSection">
                        <div class="flip-hint">👆 Clique pour retourner (molette pour scroller)</div>
                        <div class="card-container">
                            <div class="card" id="flashcard" onclick="flipCard()">
                                <div class="card-face card-front"><div class="card-text" id="question"></div></div>
                                <div class="card-face card-back"><div class="card-text" id="answer"></div></div>
                            </div>
                        </div>
                        <div class="buttons">
                            <button class="btn-known" onclick="answer('known')">✓ Connu</button>
                            <button class="btn-partial" onclick="answer('partial')">~ Partiellement</button>
                            <button class="btn-unknown" onclick="answer('unknown')">✗ Pas connu</button>
                        </div>
                        <div class="stats" id="stats"></div>
                    </div>
                    <div id="emptyState" class="empty-state" style="display:none"><div class="empty-state-icon">📝</div><h3>Aucune carte</h3></div>
                    <div id="endSection" style="display:none">
                        <div class="end-message">
                            <h2>🎉 Session terminée !</h2>
                            <div class="chart-container">
                                <div class="stat-bar-container">
                                    <div class="stat-bar-item">
                                        <div class="stat-bar-label"><div class="stat-bar-label-left"><div class="stat-bar-icon legend-known"></div><span id="legendKnown">Connu: 0 (0%)</span></div></div>
                                        <div class="stat-bar-track"><div class="stat-bar-fill stat-bar-fill-known" id="barKnown" style="width:0%">0</div></div>
                                    </div>
                                    <div class="stat-bar-item">
                                        <div class="stat-bar-label"><div class="stat-bar-label-left"><div class="stat-bar-icon legend-partial"></div><span id="legendPartial">Partiel: 0 (0%)</span></div></div>
                                        <div class="stat-bar-track"><div class="stat-bar-fill stat-bar-fill-partial" id="barPartial" style="width:0%">0</div></div>
                                    </div>
                                    <div class="stat-bar-item">
                                        <div class="stat-bar-label"><div class="stat-bar-label-left"><div class="stat-bar-icon legend-unknown"></div><span id="legendUnknown">Pas connu: 0 (0%)</span></div></div>
                                        <div class="stat-bar-track"><div class="stat-bar-fill stat-bar-fill-unknown" id="barUnknown" style="width:0%">0</div></div>
                                    </div>
                                </div>
                            </div>
                            <div class="quick-actions">
                                <button class="btn-action" onclick="showNewFolderModal()">➕ Créer un cours</button>
                                <button class="btn-action btn-action-secondary" onclick="showImportTextModal()">📋 Importer (Texte/CSV)</button>
                                <button class="btn-action btn-action-secondary" onclick="importCards()">📥 Restaurer (JSON)</button>
                                <button class="btn-export-all" onclick="exportAll()">📦 Exporter tout</button>
                            </div>
                            <div id="resultGif" class="result-gif"><img id="resultGifImg" src="" alt="Bravo !"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PAGE UTILISATEURS PUBLICS -->
            <div id="publicUsersPage" class="page">
                <div class="container">
                    <h2 style="color: var(--text); margin-bottom: 20px; font-size: 28px;">👥 Utilisateurs Publics</h2>
                    <p style="color: var(--text-soft); margin-bottom: 30px;">Découvrez et explorez les fiches publiques partagées par d'autres utilisateurs.</p>
                    
                    <div class="user-search">
                        <input type="text" id="publicUserSearch" placeholder="🔍 Rechercher un utilisateur..." 
                               oninput="searchPublicUsers()" style="width: 100%; padding: 12px; font-size: 16px;">
                    </div>
                    
                    <div id="publicUsersList" style="margin-top: 20px;">
                        <!-- Les utilisateurs seront affichés ici -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MODALS EXISTANTS -->
        <input type="file" id="fileInput" accept=".json">
        <input type="file" id="imageInput" accept="image/*">
        <input type="file" id="avatarInput" accept="image/*" style="display: none;">
        
        <!-- Modal Nouvelle Catégorie -->
        <div class="modal" id="newCategoryModal">
            <div class="modal-content">
                <div class="modal-header">Nouvelle catégorie</div>
                <div class="input-group">
                    <label for="categoryNameInput">Nom de la catégorie :</label>
                    <input type="text" id="categoryNameInput" placeholder="Ex: Droit S3">
                </div>
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="closeNewCategoryModal()">Annuler</button>
                    <button class="btn-add" onclick="createCategory()">Créer</button>
                </div>
            </div>
        </div>
        
        <!-- Modal Nouveau Cours -->
        <div class="modal" id="newFolderModal">
            <div class="modal-content">
                <div class="modal-header">Nouveau cours</div>
                <div class="input-group">
                    <label for="folderCategorySelect">Catégorie :</label>
                    <select id="folderCategorySelect"></select>
                </div>
                <div class="input-group">
                    <label for="folderNameInput">Nom du cours :</label>
                    <input type="text" id="folderNameInput" placeholder="Ex: Droit Administratif">
                </div>
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="closeNewFolderModal()">Annuler</button>
                    <button class="btn-add" onclick="createFolder()">Créer</button>
                </div>
            </div>
        </div>
        
        <!-- Modal Nouvelle Liste -->
        <div class="modal" id="newListModal">
            <div class="modal-content">
                <div class="modal-header">Nouvelle liste</div>
                <div class="input-group">
                    <label for="listNameInput">Nom de la liste :</label>
                    <input type="text" id="listNameInput" placeholder="Ex: Chapitre 1">
                </div>
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="closeNewListModal()">Annuler</button>
                    <button class="btn-add" onclick="createList()">Créer</button>
                </div>
            </div>
        </div>
        
        <!-- Modal Renommer Catégorie -->
        <div class="modal" id="renameCategoryModal">
            <div class="modal-content">
                <div class="modal-header">Renommer la catégorie</div>
                <div class="input-group">
                    <label for="renameCategoryInput">Nouveau nom :</label>
                    <input type="text" id="renameCategoryInput" placeholder="Nouveau nom">
                </div>
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="closeRenameCategoryModal()">Annuler</button>
                    <button class="btn-add" onclick="renameCategory()">Renommer</button>
                </div>
            </div>
        </div>
        
        <!-- Modal Renommer Cours -->
        <div class="modal" id="renameFolderModal">
            <div class="modal-content">
                <div class="modal-header">Renommer le cours</div>
                <div class="input-group">
                    <label for="renameFolderInput">Nouveau nom :</label>
                    <input type="text" id="renameFolderInput" placeholder="Nouveau nom du cours">
                </div>
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="closeRenameFolderModal()">Annuler</button>
                    <button class="btn-add" onclick="renameFolder()">Renommer</button>
                </div>
            </div>
        </div>
        
        <!-- Modal Renommer Liste -->
        <div class="modal" id="renameListModal">
            <div class="modal-content">
                <div class="modal-header">Renommer la liste</div>
                <div class="input-group">
                    <label for="renameListInput">Nouveau nom :</label>
                    <input type="text" id="renameListInput" placeholder="Nouveau nom de la liste">
                </div>
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="closeRenameListModal()">Annuler</button>
                    <button class="btn-add" onclick="renameList()">Renommer</button>
                </div>
            </div>
        </div>

        <!-- MODAL DE THÈME -->
        <div class="modal" id="themeModal">
            <div class="modal-content">
                <div class="modal-header">🎨 Personnaliser le thème</div>
                
                <div class="theme-section">
                    <div class="theme-section-title">📱 Pré-réglages rapides</div>
                    <div class="presets-grid" id="themePresets"></div>
                </div>
                
                <div class="theme-section">
                    <div class="theme-section-title">🎨 Couleurs principales</div>
                    <div class="theme-grid" id="primaryColors"></div>
                </div>
                
                <div class="theme-section">
                    <div class="theme-section-title">📝 Interface et texte</div>
                    <div class="theme-grid" id="interfaceColors"></div>
                </div>
                
                <div class="theme-section">
                    <div class="theme-section-title">📊 Couleurs de progression</div>
                    <div class="theme-grid" id="progressColors"></div>
                </div>
                
                <div class="live-preview">
                    <h4>👁️ Aperçu en direct</h4>
                    <div class="preview-elements">
                        <div class="preview-element" style="background: var(--primary); color: white;">Primaire</div>
                        <div class="preview-element" style="background: var(--accent); color: white;">Accent</div>
                        <div class="preview-element" style="background: var(--panel); color: var(--text); border: 1px solid var(--border);">Panneau</div>
                        <div class="preview-element" style="background: var(--known); color: white;">Connu</div>
                        <div class="preview-element" style="background: var(--partial); color: white;">Partiel</div>
                        <div class="preview-element" style="background: var(--unknown); color: white;">Inconnu</div>
                    </div>
                </div>
                
                <div class="theme-actions">
                    <button class="theme-btn theme-btn-primary" onclick="saveTheme()">
                        💾 Enregistrer
                    </button>
                    <button class="theme-btn theme-btn-secondary" onclick="closeThemeModal()">
                        ✕ Fermer
                    </button>
                    <button class="theme-btn theme-btn-danger" onclick="resetTheme()">
                        🔄 Réinitialiser
                    </button>
                    <button class="theme-btn theme-btn-success" onclick="exportTheme()">
                        📤 Exporter
                    </button>
                    <label class="theme-btn theme-btn-secondary" style="cursor: pointer;">
                        📥 Importer
                        <input type="file" id="themeImportInput" accept="application/json" style="display: none;">
                    </label>
                </div>
            </div>
        </div>

        <!-- MODAL COMPARATEUR -->
        <div id="comparatorModal">
            <div class="comparator-container">
                <div class="comparator-header" style="padding:10px 20px;">
                    <button class="btn-close-comparator" onclick="closeComparator()">✕ Fermer</button>
                </div>
                <div class="comparator-main">
                    <div class="comparator-section">
                        <div class="comp-panel">
                            <h2>Texte récent annoté</h2>
                            <div id="diffOutput"></div>
                        </div>
                    </div>
                    <button id="backToSelected" title="Aller à la carte sélectionnée">⬅ Aller à la sélection</button>
                </div>
                <div class="comp-controls">
                    <div>
                        <label for="oldText">Texte ancien</label>
                        <textarea id="oldText" placeholder="Colle ici l'ancienne version…"></textarea>
                    </div>
                    <div>
                        <label for="newText">Texte récent</label>
                        <textarea id="newText" placeholder="Colle ici la nouvelle version…"></textarea>
                    </div>
                    <div class="comp-split">
                        <button id="compareBtn">Comparer</button>
                        <button id="copyBtn" class="secondary">Copier le résultat</button>
                    </div>
                </div>
                <div class="comparator-aside">
                    <div class="comp-summary">
                        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
                            <code class="badge">Insertions: <span id="insCount">0</span></code>
                            <code class="badge">Suppressions: <span id="delCount">0</span></code>
                            <code class="badge">Remplacements: <span id="repCount">0</span></code>
                        </div>
                        <small id="hint">Colle tes textes puis clique sur « Comparer ».</small>
                    </div>
                    <div class="comp-toolbar">
                        <strong>Changements</strong>
                        <span style="flex:1"></span>
                        <button id="toggleOnlyDeletions" class="btn-filter-del">➖ Suppressions uniquement</button>
                        <button id="toggleContext" class="secondary">± Contexte</button>
                    </div>
                    <div id="changesList" class="comp-changes"></div>
                </div>
            </div>
        </div>
        
        <!-- MODAL IMPORT TEXTE -->
        <div class="modal" id="importTextModal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">Importer depuis Texte / Quizlet</div>
               
                <div class="input-group">
                    <label>1. Destination :</label>
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <select id="importCatSelect" onchange="updateImportFolderSelect()" style="flex:1"></select>
                        <select id="importFolderSelect" style="flex:1"></select>
                    </div>
                    <input type="text" id="importListName" placeholder="Nom de la liste (ex: Chapitre 1)">
                </div>
                <div class="input-group">
                    <label>2. Séparateur entre Question et Réponse :</label>
                    <select id="importSeparator">
                        <option value="tab">Tabulation (Quizlet par défaut)</option>
                        <option value=",">Virgule (,)</option>
                        <option value=";">Point-virgule (;)</option>
                        <option value=":">Deux-points (:)</option>
                        <option value="-">Tiret (-)</option>
                        <option value="|">Barre verticale (|)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>3. Collez votre texte ici :</label>
                    <textarea id="importTextContent" style="width:100%; height:200px; padding:10px; border:2px solid var(--border); border-radius:8px; font-family:monospace; resize:vertical;" placeholder="Terme 1 Définition 1&#10;Terme 2 Définition 2"></textarea>
                </div>
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="closeImportTextModal()">Annuler</button>
                    <button class="btn-add" onclick="performTextImport()">Importer les cartes</button>
                </div>
            </div>
        </div>
        
        <!-- MODAL PROFIL UTILISATEUR -->
        <div class="modal" id="userProfileModal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header" style="display: flex; align-items: center; gap: 15px;">
                    <div class="user-avatar" id="profileAvatar">U</div>
                    <div>
                        <h2 id="profileUsername" style="margin: 0;">Utilisateur</h2>
                        <p id="profileInfo" style="margin: 0; color: var(--text-soft); font-size: 14px;">Membre</p>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <h3>Cours publics</h3>
                    <div id="profileCoursesList" style="max-height: 300px; overflow-y: auto; margin-top: 10px;"></div>
                </div>
                
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="closeUserProfileModal()">Fermer</button>
                    <button class="btn-add" onclick="importFromUser()">Importer la sélection</button>
                </div>
            </div>
        </div>
        
        <!-- MODAL PARAMÈTRES PROFIL -->
        <div class="modal profile-settings-modal" id="profileSettingsModal">
            <div class="modal-content">
                <div class="modal-header">👤 Paramètres du profil</div>
                
                <div class="avatar-upload">
                    <div class="avatar-preview" id="avatarPreview" onclick="document.getElementById('avatarInput').click()">
                        <!-- L'image sera ajoutée dynamiquement -->
                    </div>
                    <p style="font-size: 12px; color: var(--text-soft); margin-top: 5px;">Cliquez pour changer la photo</p>
                </div>
                
                <div class="profile-form">
                    <div class="input-group">
                        <label for="settingsUsername">Nom d'utilisateur</label>
                        <input type="text" id="settingsUsername" placeholder="Votre nom d'utilisateur">
                    </div>
                    
                    <div class="input-group">
                        <label for="settingsEmail">Email</label>
                        <input type="email" id="settingsEmail" placeholder="votre@email.com">
                    </div>
                    
                    <div class="input-group">
                        <label for="settingsBio">Bio (optionnel)</label>
                        <textarea id="settingsBio" placeholder="Parlez un peu de vous..." rows="3"></textarea>
                    </div>
                    
                    <div class="input-group">
                        <label for="settingsCurrentPassword">Mot de passe actuel (pour modifier)</label>
                        <input type="password" id="settingsCurrentPassword" placeholder="Entrez votre mot de passe actuel">
                    </div>
                    
                    <div class="input-group">
                        <label for="settingsNewPassword">Nouveau mot de passe</label>
                        <input type="password" id="settingsNewPassword" placeholder="Laissez vide pour ne pas changer">
                    </div>
                    
                    <div class="input-group">
                        <label for="settingsConfirmPassword">Confirmer le nouveau mot de passe</label>
                        <input type="password" id="settingsConfirmPassword" placeholder="Confirmez le nouveau mot de passe">
                    </div>
                </div>
                
                <div class="profile-actions">
                    <button class="btn-add" onclick="saveProfileSettings()">💾 Enregistrer</button>
                    <button class="btn-cancel" onclick="closeProfileSettings()">Annuler</button>
                </div>
                
                <div class="danger-zone">
                    <h4>⚠️ Zone dangereuse</h4>
                    <p style="font-size: 12px; color: var(--text-soft); margin-bottom: 15px;">
                        Ces actions sont irréversibles. Soyez certain de ce que vous faites.
                    </p>
                    <button class="btn-danger" onclick="deleteAccount()" style="width: 100%;">
                        🗑️ Supprimer mon compte
                    </button>
                </div>
            </div>
        </div>
        
        <!-- MODAL COURS PUBLIC -->
        <div class="modal" id="publicCourseModal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 id="publicCourseTitle" style="margin: 0;">Cours Public</h2>
                        <p id="publicCourseOwner" style="margin: 0; color: var(--text-soft); font-size: 14px;">Par Utilisateur</p>
                    </div>
                    <button class="close-modal" onclick="closePublicCourseModal()">✕</button>
                </div>
                
                <div style="margin: 20px 0;">
                    <h3>Listes disponibles</h3>
                    <div class="course-lists" id="publicCourseLists"></div>
                </div>
                
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="closePublicCourseModal()">Fermer</button>
                    <button class="btn-add" onclick="importPublicCourse()">Importer la sélection</button>
                </div>
            </div>
        </div>
        
        <!-- Mode plein écran pour les fiches -->
        <div id="fullscreenMode" class="fullscreen-mode">
            <button class="fullscreen-close-btn" onclick="exitFullscreen()">✕</button>
            <div class="fullscreen-card-container">
                <div class="fullscreen-card" id="fullscreenCard" onclick="flipFullscreenCard()">
                    <div class="fullscreen-card-face fullscreen-card-front">
                        <div class="fullscreen-card-text" id="fullscreenQuestion"></div>
                    </div>
                    <div class="fullscreen-card-face fullscreen-card-back">
                        <div class="fullscreen-card-text" id="fullscreenAnswer"></div>
                    </div>
                </div>
            </div>
            <div class="fullscreen-controls">
                <button class="fullscreen-btn" style="background: linear-gradient(135deg, var(--known) 0%, var(--accent-2) 100%);" onclick="fullscreenAnswer('known')">✓ Connu</button>
                <button class="fullscreen-btn" style="background: linear-gradient(135deg, var(--partial) 0%, #f7b733 100%);" onclick="fullscreenAnswer('partial')">~ Partiel</button>
                <button class="fullscreen-btn" style="background: linear-gradient(135deg, var(--unknown) 0%, #ee5a6f 100%);" onclick="fullscreenAnswer('unknown')">✗ Inconnu</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script src="https://cdn.jsdelivr.net/npm/diff@5.1.0/dist/diff.min.js"></script>
    <script>
        // ====== SYSTÈME D'AUTHENTIFICATION ======
        let currentUser = null;
        let allUsers = {};
        let categories = {};
        let results = {};
        let openCategories = {};
        let currentCategory = null;
        let currentFolder = null;
        let currentList = null;
        let currentPage = 'home';
        let currentIndex = 0;
        let isFlipped = false;
        let isReviewMode = false;
        let reviewIndices = [];
        let stats = {known: 0, partial: 0, unknown: 0};
        let currentEditingSide = null;
        let renameTarget = null;
        window.activeImportanceFilter = [];
        window.currentImportance = 'normal';
        
        const GIF_KNOWN_URL = 'https://media.giphy.com/media/111ebonMs90YLu/giphy.gif';
        
        // ====== FONCTIONS D'AUTHENTIFICATION ======
        function loadUsers() {
            const usersData = localStorage.getItem('flashcards_users');
            if (usersData) {
                try {
                    allUsers = JSON.parse(usersData);
                } catch (e) {
                    allUsers = {};
                }
            }
            
            // Créer un utilisateur admin par défaut s'il n'existe pas
            if (!allUsers['admin']) {
                allUsers['admin'] = {
                    password: btoa('admin123'),
                    email: 'admin@example.com',
                    createdAt: new Date().toISOString(),
                    publicProfile: true,
                    folders: {
                        '📚 Exemples': {
                            'Droit Administratif': {
                                'Chapitre 1': [
                                    {question: "Qu'est-ce que le principe de légalité ?", answer: "Le principe selon lequel l'administration doit agir conformément aux règles de droit.", importance: 'important'},
                                    {question: "Qu'est-ce que la théorie du service public ?", answer: "Une théorie développée par Léon Duguit selon laquelle l'État doit assurer certains services essentiels à la population.", importance: 'normal'}
                                ]
                            },
                            'Histoire de France': {
                                'Révolution Française': [
                                    {question: "Quand a commencé la Révolution Française ?", answer: "1789", importance: 'important'},
                                    {question: "Qui était roi de France en 1789 ?", answer: "Louis XVI", importance: 'normal'}
                                ]
                            }
                        }
                    }
                };
                saveUsers();
            }
        }
        
        function saveUsers() {
            localStorage.setItem('flashcards_users', JSON.stringify(allUsers));
        }
        
        function showAuthError(message) {
            const errorDiv = document.getElementById('authError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        
        function showAuthSuccess(message) {
            const successDiv = document.getElementById('authSuccess');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }
        
        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }
        
        function showLogin() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }
        
        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!username || !password) {
                showAuthError('Veuillez remplir tous les champs');
                return;
            }
            
            if (!allUsers[username]) {
                showAuthError('Utilisateur non trouvé');
                return;
            }
            
            if (allUsers[username].password !== btoa(password)) {
                showAuthError('Mot de passe incorrect');
                return;
            }
            
            // Connexion réussie
            currentUser = {
                username: username,
                ...allUsers[username]
            };
            
            localStorage.setItem('current_user', JSON.stringify(currentUser));
            showHomepage();
        }
        
        function register() {
            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const confirmPassword = document.getElementById('registerConfirmPassword').value.trim();
            
            if (!username || !password) {
                showAuthError('Nom d\'utilisateur et mot de passe requis');
                return;
            }
            
            if (password !== confirmPassword) {
                showAuthError('Les mots de passe ne correspondent pas');
                return;
            }
            
            if (username.length < 3) {
                showAuthError('Le nom d\'utilisateur doit faire au moins 3 caractères');
                return;
            }
            
            if (allUsers[username]) {
                showAuthError('Ce nom d\'utilisateur est déjà pris');
                return;
            }
            
            // Créer le nouvel utilisateur
            allUsers[username] = {
                password: btoa(password),
                email: email || '',
                createdAt: new Date().toISOString(),
                publicProfile: true,
                folders: {}
            };
            
            saveUsers();
            showAuthSuccess('Compte créé avec succès !');
            showLogin();
            
            document.getElementById('loginUsername').value = username;
            document.getElementById('loginPassword').value = '';
        }
        
        function loginAsGuest() {
            const guestId = 'guest_' + Math.random().toString(36).substr(2, 9);
            currentUser = {
                username: guestId,
                guest: true,
                publicProfile: false,
                folders: {},
                createdAt: new Date().toISOString()
            };
            
            allUsers[guestId] = currentUser;
            saveUsers();
            localStorage.setItem('current_user', JSON.stringify(currentUser));
            showHomepage();
        }
        
        function checkAuth() {
            const savedUser = localStorage.getItem('current_user');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showHomepage();
                    return;
                } catch (e) {
                    // Erreur de parsing
                }
            }
            document.getElementById('authPage').style.display = 'flex';
        }
        
        function showHomepage() {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('homepage').style.display = 'block';
            
            // Mettre à jour l'affichage de l'utilisateur
            updateUserDisplay();
            loadHomepageData();
        }
        
        function showApp() {
            document.getElementById('homepage').style.display = 'none';
            document.getElementById('appContent').style.display = 'flex';
            
            // Charger les données
            loadData();
            loadTheme();
            
            // Initialiser l'application
            updateCategoryList();
            updateHomeStats();
            
            // Initialiser le comparateur
            const oldTA = document.getElementById('oldText');
            const newTA = document.getElementById('newText');
            if (oldTA && newTA) {
                oldTA.value = "Le contrat entre en vigueur le 1er janvier 2024.\nLe prix est de 100€.\nLe client accepte les conditions.";
                newTA.value = "Le contrat prend effet le 1er janvier 2025.\nLe prix est de 120 €.\nLe client accepte pleinement les conditions générales.";
            }
        }
        
        function updateUserDisplay() {
            if (!currentUser) return;
            
            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userStatus').textContent = currentUser.guest ? 'Invité' : 'Membre';
            document.getElementById('homeUsername').textContent = currentUser.username;
            document.getElementById('heroUsername').textContent = currentUser.username;
            
            // Mettre à jour l'avatar
            const avatarDiv = document.getElementById('userAvatar');
            const homeAvatar = document.getElementById('homeAvatar');
            if (currentUser.avatar) {
                avatarDiv.innerHTML = `<img src="${currentUser.avatar}" alt="${currentUser.username}">`;
                homeAvatar.innerHTML = `<img src="${currentUser.avatar}" alt="${currentUser.username}">`;
            } else {
                const initial = currentUser.username.charAt(0).toUpperCase();
                avatarDiv.innerHTML = initial;
                homeAvatar.innerHTML = initial;
            }
            
            const toggle = document.getElementById('publicProfileToggle');
            if (toggle) {
                toggle.checked = currentUser.publicProfile || false;
            }
        }
        
        function loadHomepageData() {
            // Charger les cours récents
            const recentCoursesDiv = document.getElementById('recentCourses');
            const publicCoursesDiv = document.getElementById('publicCourses');
            
            recentCoursesDiv.innerHTML = '';
            publicCoursesDiv.innerHTML = '';
            
            if (currentUser && currentUser.folders) {
                // Afficher jusqu'à 5 cours récents
                let count = 0;
                Object.keys(currentUser.folders).forEach(catName => {
                    Object.keys(currentUser.folders[catName]).forEach(folderName => {
                        if (count < 5) {
                            const folder = currentUser.folders[catName][folderName];
                            let totalCards = 0;
                            Object.values(folder).forEach(list => {
                                totalCards += list.length;
                            });
                            
                            const card = document.createElement('div');
                            card.className = 'card';
                            card.innerHTML = `
                                <div class="card-title">${escapeHtml(folderName)}</div>
                                <div class="card-info">${totalCards} cartes</div>
                            `;
                            card.onclick = () => {
                                showApp();
                                setTimeout(() => showListsPage(catName, folderName), 100);
                            };
                            recentCoursesDiv.appendChild(card);
                            count++;
                        }
                    });
                });
            }
            
            // Afficher les cours publics populaires
            let publicCount = 0;
            Object.keys(allUsers).forEach(username => {
                const user = allUsers[username];
                if (user.publicProfile && user.folders && username !== currentUser.username) {
                    Object.keys(user.folders).forEach(catName => {
                        Object.keys(user.folders[catName]).forEach(folderName => {
                            if (publicCount < 5) {
                                const folder = user.folders[catName][folderName];
                                let totalCards = 0;
                                Object.values(folder).forEach(list => {
                                    totalCards += list.length;
                                });
                                
                                const card = document.createElement('div');
                                card.className = 'card';
                                card.innerHTML = `
                                    <div class="card-title">${escapeHtml(folderName)}</div>
                                    <div class="card-info">Par ${escapeHtml(username)} • ${totalCards} cartes</div>
                                `;
                                card.onclick = () => {
                                    viewPublicCourse(username, catName, folderName);
                                };
                                publicCoursesDiv.appendChild(card);
                                publicCount++;
                            }
                        });
                    });
                }
            });
        }
        
        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('active');
        }
        
        function logout() {
            if (confirm('Voulez-vous vraiment vous déconnecter ?')) {
                localStorage.removeItem('current_user');
                location.reload();
            }
        }
        
        function togglePublicProfile() {
            if (!currentUser) return;
            
            const isPublic = document.getElementById('publicProfileToggle').checked;
            currentUser.publicProfile = isPublic;
            allUsers[currentUser.username] = currentUser;
            saveUsers();
            
            showNotification('Profil ' + (isPublic ? 'public' : 'privé') + ' ✓', 'success');
        }
        
        // ====== NOTIFICATIONS ======
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // ====== GESTION DES PARAMÈTRES PROFIL ======
        function openProfileSettings() {
            const modal = document.getElementById('profileSettingsModal');
            const avatarPreview = document.getElementById('avatarPreview');
            
            // Remplir les champs
            document.getElementById('settingsUsername').value = currentUser.username;
            document.getElementById('settingsEmail').value = currentUser.email || '';
            document.getElementById('settingsBio').value = currentUser.bio || '';
            
            // Mettre à jour l'avatar preview
            if (currentUser.avatar) {
                avatarPreview.innerHTML = `<img src="${currentUser.avatar}" alt="${currentUser.username}">`;
            } else {
                avatarPreview.innerHTML = currentUser.username.charAt(0).toUpperCase();
            }
            
            // Réinitialiser les champs de mot de passe
            document.getElementById('settingsCurrentPassword').value = '';
            document.getElementById('settingsNewPassword').value = '';
            document.getElementById('settingsConfirmPassword').value = '';
            
            modal.classList.add('show');
        }
        
        function closeProfileSettings() {
            document.getElementById('profileSettingsModal').classList.remove('show');
        }
        
        // Gestion du changement d'avatar
        document.getElementById('avatarInput').addEventListener('change', function(e) {
            const file = e.target.files?.[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const avatarData = event.target.result;
                
                // Mettre à jour l'avatar preview
                const avatarPreview = document.getElementById('avatarPreview');
                avatarPreview.innerHTML = `<img src="${avatarData}" alt="Avatar">`;
                
                // Sauvegarder temporairement
                currentUser.avatar = avatarData;
                
                showNotification('Photo de profil mise à jour ✓', 'success');
            };
            reader.readAsDataURL(file);
        });
        
        function saveProfileSettings() {
            const username = document.getElementById('settingsUsername').value.trim();
            const email = document.getElementById('settingsEmail').value.trim();
            const bio = document.getElementById('settingsBio').value.trim();
            const currentPassword = document.getElementById('settingsCurrentPassword').value.trim();
            const newPassword = document.getElementById('settingsNewPassword').value.trim();
            const confirmPassword = document.getElementById('settingsConfirmPassword').value.trim();
            
            // Vérifier si le nom d'utilisateur a changé
            if (username !== currentUser.username) {
                if (allUsers[username] && username !== currentUser.username) {
                    showNotification('Ce nom d\'utilisateur est déjà pris', 'error');
                    return;
                }
                
                // Mettre à jour le nom d'utilisateur
                delete allUsers[currentUser.username];
                currentUser.username = username;
            }
            
            // Vérifier le mot de passe si on veut le changer
            if (newPassword) {
                if (newPassword !== confirmPassword) {
                    showNotification('Les mots de passe ne correspondent pas', 'error');
                    return;
                }
                
                if (currentPassword && allUsers[currentUser.username].password !== btoa(currentPassword)) {
                    showNotification('Mot de passe actuel incorrect', 'error');
                    return;
                }
                
                currentUser.password = btoa(newPassword);
            }
            
            // Mettre à jour les autres infos
            currentUser.email = email;
            currentUser.bio = bio;
            
            // Sauvegarder l'utilisateur
            allUsers[currentUser.username] = currentUser;
            saveUsers();
            
            // Mettre à jour l'affichage
            updateUserDisplay();
            
            // Fermer le modal
            closeProfileSettings();
            
            showNotification('Paramètres enregistrés avec succès ✓', 'success');
        }
        
        function deleteAccount() {
            if (!confirm('⚠️ ATTENTION : Cette action supprimera définitivement votre compte et toutes vos données. Êtes-vous sûr ?')) {
                return;
            }
            
            if (confirm('Pour confirmer, tapez "SUPPRIMER" :')) {
                const confirmation = prompt('Tapez "SUPPRIMER" pour confirmer la suppression :');
                if (confirmation === 'SUPPRIMER') {
                    // Supprimer l'utilisateur
                    delete allUsers[currentUser.username];
                    saveUsers();
                    
                    // Supprimer les données locales
                    localStorage.removeItem('current_user');
                    localStorage.removeItem(`flashcards_results_${currentUser.username}`);
                    localStorage.removeItem(`flashcards_open_${currentUser.username}`);
                    
                    // Rediriger vers la page d'authentification
                    location.reload();
                }
            }
        }
        
        // ====== GESTION DES UTILISATEURS PUBLICS ======
        function showPublicUsers() {
            if (document.getElementById('homepage').style.display === 'block') {
                // Si on est sur la homepage, afficher dans l'application
                showApp();
                setTimeout(() => {
                    document.getElementById('publicUsersPage').classList.add('active');
                    document.querySelectorAll('.page').forEach(page => {
                        if (page.id !== 'publicUsersPage') page.classList.remove('active');
                    });
                    loadPublicUsers();
                }, 100);
            } else {
                // Si on est dans l'application
                document.getElementById('publicUsersPage').classList.add('active');
                document.querySelectorAll('.page').forEach(page => {
                    if (page.id !== 'publicUsersPage') page.classList.remove('active');
                });
                loadPublicUsers();
            }
        }
        
        function loadPublicUsers() {
            const publicUsersList = document.getElementById('publicUsersList');
            publicUsersList.innerHTML = '';
            
            let hasPublicUsers = false;
            
            Object.keys(allUsers).forEach(username => {
                const user = allUsers[username];
                if (user.publicProfile && user.folders && Object.keys(user.folders).length > 0 && username !== currentUser.username) {
                    hasPublicUsers = true;
                    
                    // Compter le nombre total de cartes
                    let totalCards = 0;
                    let totalCourses = 0;
                    Object.values(user.folders).forEach(category => {
                        Object.values(category).forEach(folder => {
                            totalCourses++;
                            Object.values(folder).forEach(list => {
                                totalCards += list.length;
                            });
                        });
                    });
                    
                    const userCard = document.createElement('div');
                    userCard.className = 'user-card';
                    userCard.onclick = () => viewUserProfile(username);
                    
                    let avatarContent = username.charAt(0).toUpperCase();
                    if (user.avatar) {
                        avatarContent = `<img src="${user.avatar}" alt="${username}">`;
                    }
                    
                    userCard.innerHTML = `
                        <div class="user-avatar-small">${avatarContent}</div>
                        <div class="user-info">
                            <div class="user-name">${escapeHtml(username)}</div>
                            <div class="user-stats">${totalCourses} cours • ${totalCards} cartes</div>
                        </div>
                    `;
                    
                    publicUsersList.appendChild(userCard);
                }
            });
            
            if (!hasPublicUsers) {
                publicUsersList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-soft);">
                        <h3>Aucun utilisateur public trouvé</h3>
                        <p>Les autres utilisateurs doivent rendre leur profil public pour apparaître ici.</p>
                    </div>
                `;
            }
        }
        
        function searchPublicUsers() {
            const searchTerm = document.getElementById('publicUserSearch').value.toLowerCase().trim();
            const publicUsersList = document.getElementById('publicUsersList');
            const allUserCards = publicUsersList.querySelectorAll('.user-card');
            
            allUserCards.forEach(card => {
                const userName = card.querySelector('.user-name').textContent.toLowerCase();
                if (userName.includes(searchTerm)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        let selectedPublicCourses = [];
        
        function viewUserProfile(username) {
            const user = allUsers[username];
            if (!user) return;
            
            selectedPublicCourses = [];
            
            const modal = document.getElementById('userProfileModal');
            document.getElementById('profileUsername').textContent = username;
            document.getElementById('profileInfo').textContent = `Membre depuis ${new Date(user.createdAt).toLocaleDateString()}`;
            
            const avatarDiv = document.getElementById('profileAvatar');
            if (user.avatar) {
                avatarDiv.innerHTML = `<img src="${user.avatar}" alt="${username}">`;
            } else {
                avatarDiv.innerHTML = username.charAt(0).toUpperCase();
            }
            
            const coursesList = document.getElementById('profileCoursesList');
            coursesList.innerHTML = '';
            
            if (Object.keys(user.folders || {}).length === 0) {
                coursesList.innerHTML = '<p style="color: var(--text-soft); text-align: center; padding: 20px;">Aucun cours public</p>';
            } else {
                Object.keys(user.folders).forEach(categoryName => {
                    const category = user.folders[categoryName];
                    Object.keys(category).forEach(folderName => {
                        const folder = category[folderName];
                        const courseDiv = document.createElement('div');
                        courseDiv.className = 'list-item';
                        
                        let listCount = 0;
                        let totalCards = 0;
                        Object.keys(folder).forEach(listName => {
                            listCount++;
                            totalCards += folder[listName].length;
                        });
                        
                        courseDiv.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600; color: var(--text);">${escapeHtml(folderName)}</div>
                                    <div style="font-size: 12px; color: var(--text-soft);">
                                        ${listCount} listes • ${totalCards} cartes
                                    </div>
                                </div>
                                <div>
                                    <input type="checkbox" class="course-checkbox" 
                                           data-category="${categoryName}" 
                                           data-folder="${folderName}"
                                           onchange="togglePublicCourseSelection(this)">
                                </div>
                            </div>
                        `;
                        coursesList.appendChild(courseDiv);
                    });
                });
            }
            
            modal.classList.add('show');
        }
        
        function togglePublicCourseSelection(checkbox) {
            const category = checkbox.dataset.category;
            const folder = checkbox.dataset.folder;
            const username = document.getElementById('profileUsername').textContent;
            
            if (checkbox.checked) {
                selectedPublicCourses.push({ username, category, folder });
            } else {
                const index = selectedPublicCourses.findIndex(c => 
                    c.username === username && c.category === category && c.folder === folder);
                if (index > -1) {
                    selectedPublicCourses.splice(index, 1);
                }
            }
        }
        
        function importFromUser() {
            if (selectedPublicCourses.length === 0) {
                showNotification('Sélectionnez au moins un cours à importer', 'error');
                return;
            }
            
            let importedCount = 0;
            selectedPublicCourses.forEach(({ username, category, folder }) => {
                const sourceUser = allUsers[username];
                if (sourceUser && sourceUser.folders[category] && sourceUser.folders[category][folder]) {
                    // Créer une copie profonde
                    const importedData = JSON.parse(JSON.stringify(sourceUser.folders[category][folder]));
                    
                    // Vérifier si la catégorie existe déjà
                    if (!currentUser.folders[category]) {
                        currentUser.folders[category] = {};
                    }
                    
                    // Vérifier si le cours existe déjà
                    let finalFolderName = folder;
                    let counter = 1;
                    while (currentUser.folders[category][finalFolderName]) {
                        finalFolderName = `${folder} (${counter})`;
                        counter++;
                    }
                    
                    currentUser.folders[category][finalFolderName] = importedData;
                    importedCount++;
                }
            });
            
            if (importedCount > 0) {
                // Sauvegarder
                allUsers[currentUser.username] = currentUser;
                saveUsers();
                
                // Mettre à jour les données locales
                categories = currentUser.folders;
                
                // Fermer le modal et rafraîchir
                closeUserProfileModal();
                updateCategoryList();
                updateHomeStats();
                loadHomepageData();
                
                showNotification(`${importedCount} cours importés avec succès !`, 'success');
            } else {
                showNotification('Aucun cours importé', 'error');
            }
        }
        
        function closeUserProfileModal() {
            document.getElementById('userProfileModal').classList.remove('show');
        }
        
        function viewPublicCourse(username, category, folder) {
            const user = allUsers[username];
            if (!user || !user.folders[category] || !user.folders[category][folder]) {
                showNotification('Cours non trouvé', 'error');
                return;
            }
            
            const modal = document.getElementById('publicCourseModal');
            document.getElementById('publicCourseTitle').textContent = folder;
            document.getElementById('publicCourseOwner').textContent = `Par ${username}`;
            
            const listsDiv = document.getElementById('publicCourseLists');
            listsDiv.innerHTML = '';
            
            const folderData = user.folders[category][folder];
            Object.keys(folderData).forEach(listName => {
                const list = folderData[listName];
                const listItem = document.createElement('div');
                listItem.className = 'list-item';
                listItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; color: var(--text);">${escapeHtml(listName)}</div>
                            <div style="font-size: 12px; color: var(--text-soft);">
                                ${list.length} cartes
                            </div>
                        </div>
                        <div>
                            <input type="checkbox" class="list-checkbox" 
                                   data-list="${listName}"
                                   onchange="togglePublicListSelection(this)">
                        </div>
                    </div>
                `;
                listsDiv.appendChild(listItem);
            });
            
            modal.classList.add('show');
        }
        
        function closePublicCourseModal() {
            document.getElementById('publicCourseModal').classList.remove('show');
        }
        
        function togglePublicListSelection(checkbox) {
            // Cette fonction peut être étendue pour gérer la sélection de listes spécifiques
        }
        
        function importPublicCourse() {
            // Importer le cours public sélectionné
            const title = document.getElementById('publicCourseTitle').textContent;
            const owner = document.getElementById('publicCourseOwner').textContent.replace('Par ', '');
            
            // Trouver le cours dans les données de l'utilisateur
            const user = allUsers[owner];
            if (!user) return;
            
            // Chercher le cours dans les dossiers de l'utilisateur
            let courseData = null;
            let courseCategory = null;
            
            Object.keys(user.folders).forEach(category => {
                Object.keys(user.folders[category]).forEach(folder => {
                    if (folder === title) {
                        courseData = user.folders[category][folder];
                        courseCategory = category;
                    }
                });
            });
            
            if (!courseData) {
                showNotification('Cours non trouvé', 'error');
                return;
            }
            
            // Créer une copie profonde
            const importedData = JSON.parse(JSON.stringify(courseData));
            
            // Vérifier si la catégorie existe déjà
            if (!currentUser.folders[courseCategory]) {
                currentUser.folders[courseCategory] = {};
            }
            
            // Vérifier si le cours existe déjà
            let finalFolderName = title;
            let counter = 1;
            while (currentUser.folders[courseCategory][finalFolderName]) {
                finalFolderName = `${title} (${counter})`;
                counter++;
            }
            
            currentUser.folders[courseCategory][finalFolderName] = importedData;
            
            // Sauvegarder
            allUsers[currentUser.username] = currentUser;
            saveUsers();
            
            // Mettre à jour les données locales
            categories = currentUser.folders;
            
            // Fermer le modal et rafraîchir
            closePublicCourseModal();
            updateCategoryList();
            updateHomeStats();
            loadHomepageData();
            
            showNotification(`Cours "${title}" importé avec succès !`, 'success');
        }
        
        // ====== FONCTIONS DE GESTION DES DONNÉES ======
        function loadData() {
            // Charger les données de l'utilisateur courant
            if (currentUser && currentUser.folders) {
                categories = currentUser.folders;
            } else {
                categories = {};
            }
            
            // Charger les résultats spécifiques à l'utilisateur
            const userResultsKey = `flashcards_results_${currentUser.username}`;
            const resData = localStorage.getItem(userResultsKey);
            if (resData) {
                try {
                    results = JSON.parse(resData);
                } catch (e) {
                    results = {};
                }
            }
            
            // Charger les catégories ouvertes
            const openData = localStorage.getItem(`flashcards_open_${currentUser.username}`);
            if (openData) {
                try {
                    openCategories = JSON.parse(openData);
                } catch (e) {
                    openCategories = {};
                }
            }
            
            // Si pas de données, créer des exemples
            if (Object.keys(categories).length === 0) {
                categories = {
                    '📚 Mes cours': {
                        'Droit Administratif': {
                            'Chapitre 1': [
                                {question: "Qu'est-ce que le principe de légalité ?", answer: "Le principe selon lequel l'administration doit agir conformément aux règles de droit.", importance: 'important'},
                                {question: "Qu'est-ce que la théorie du service public ?", answer: "Une théorie développée par Léon Duguit selon laquelle l'État doit assurer certains services essentiels à la population.", importance: 'normal'}
                            ]
                        }
                    }
                };
                openCategories['📚 Mes cours'] = true;
                currentUser.folders = categories;
                allUsers[currentUser.username] = currentUser;
                saveUsers();
            }
        }
        
        function saveData() {
            if (currentUser) {
                currentUser.folders = categories;
                allUsers[currentUser.username] = currentUser;
                saveUsers();
                
                // Sauvegarder les catégories ouvertes
                localStorage.setItem(`flashcards_open_${currentUser.username}`, JSON.stringify(openCategories));
            }
            
            updateHomeStats();
            loadHomepageData();
        }
        
        function saveResults() {
            if (currentUser) {
                const userResultsKey = `flashcards_results_${currentUser.username}`;
                localStorage.setItem(userResultsKey, JSON.stringify(results));
            }
        }
        
        // ====== FONCTIONS DE GESTION DES CATÉGORIES ET DOSSIERS ======
        function toggleCategory(catName) {
            openCategories[catName] = !openCategories[catName];
            localStorage.setItem(`flashcards_open_${currentUser.username}`, JSON.stringify(openCategories));
            updateCategoryList();
        }
        
        function showNewCategoryModal() {
            document.getElementById('newCategoryModal').classList.add('show');
            const input = document.getElementById('categoryNameInput');
            input.value = '';
            setTimeout(() => input.focus(), 150);
        }
        
        function closeNewCategoryModal() {
            document.getElementById('newCategoryModal').classList.remove('show');
            document.getElementById('categoryNameInput').value = '';
        }
        
        function createCategory() {
            const input = document.getElementById('categoryNameInput');
            const name = input.value.trim();
            if (!name) {
                showNotification('Veuillez entrer un nom.', 'error');
                setTimeout(() => input.focus(), 150);
                return;
            }
            if (categories[name]) {
                showNotification('Cette catégorie existe déjà.', 'error');
                input.value = '';
                setTimeout(() => input.focus(), 150);
                return;
            }
            categories[name] = {};
            openCategories[name] = true;
            saveData();
            updateCategoryList();
            closeNewCategoryModal();
            showNotification('Catégorie créée avec succès ✓', 'success');
        }
        
        function deleteCategory(catName) {
            if (!confirm('Supprimer "' + catName + '" et tous ses cours ?')) return;
            delete categories[catName];
            delete results[catName];
            delete openCategories[catName];
            saveData();
            saveResults();
            if (currentCategory === catName) showPage('home');
            updateCategoryList();
            showNotification('Catégorie supprimée ✓', 'success');
        }
        
        function showEditCategoryModal(catName) {
            renameTarget = catName;
            document.getElementById('renameCategoryModal').classList.add('show');
            const input = document.getElementById('renameCategoryInput');
            input.value = catName;
            setTimeout(() => input.focus(), 150);
        }
        
        function closeRenameCategoryModal() {
            document.getElementById('renameCategoryModal').classList.remove('show');
            document.getElementById('renameCategoryInput').value = '';
            renameTarget = null;
        }
        
        function renameCategory() {
            const input = document.getElementById('renameCategoryInput');
            const newName = input.value.trim();
            if (!newName) {
                showNotification('Veuillez entrer un nom.', 'error');
                setTimeout(() => input.focus(), 150);
                return;
            }
            if (categories[newName] && newName !== renameTarget) {
                showNotification('Ce nom existe déjà.', 'error');
                input.value = '';
                setTimeout(() => input.focus(), 150);
                return;
            }
            if (renameTarget && categories[renameTarget]) {
                categories[newName] = categories[renameTarget];
                delete categories[renameTarget];
                if (results[renameTarget]) {
                    results[newName] = results[renameTarget];
                    delete results[renameTarget];
                    saveResults();
                }
                if (openCategories[renameTarget]) {
                    openCategories[newName] = openCategories[renameTarget];
                    delete openCategories[renameTarget];
                }
                if (currentCategory === renameTarget) currentCategory = newName;
                saveData();
                updateCategoryList();
                closeRenameCategoryModal();
                showNotification('Catégorie renommée ✓', 'success');
            }
        }
        
        function updateFolderCategorySelect() {
            const select = document.getElementById('folderCategorySelect');
            select.innerHTML = '';
            const catNames = Object.keys(categories);
            if (catNames.length === 0) {
                const opt = document.createElement('option');
                opt.value = '';
                opt.textContent = 'Aucune catégorie - Créez-en une !';
                select.appendChild(opt);
            } else {
                catNames.forEach(catName => {
                    const opt = document.createElement('option');
                    opt.value = catName;
                    opt.textContent = catName;
                    if (catName === currentCategory) opt.selected = true;
                    select.appendChild(opt);
                });
            }
        }
        
        function showNewFolderModal() {
            updateFolderCategorySelect();
            document.getElementById('newFolderModal').classList.add('show');
            const input = document.getElementById('folderNameInput');
            input.value = '';
            setTimeout(() => input.focus(), 150);
        }
        
        function closeNewFolderModal() {
            document.getElementById('newFolderModal').classList.remove('show');
            document.getElementById('folderNameInput').value = '';
        }
        
        function createFolder() {
            const input = document.getElementById('folderNameInput');
            const name = input.value.trim();
            const catSelect = document.getElementById('folderCategorySelect');
            const selectedCat = catSelect.value;
            if (!selectedCat) {
                showNotification('Veuillez créer une catégorie d\'abord.', 'error');
                return;
            }
            if (!name) {
                showNotification('Veuillez entrer un nom de cours.', 'error');
                setTimeout(() => input.focus(), 150);
                return;
            }
            if (categories[selectedCat][name]) {
                showNotification('Ce cours existe déjà dans cette catégorie.', 'error');
                input.value = '';
                setTimeout(() => input.focus(), 150);
                return;
            }
            categories[selectedCat][name] = {'Liste par défaut': []};
            saveData();
            updateCategoryList();
            closeNewFolderModal();
            showListsPage(selectedCat, name);
            showNotification('Cours créé avec succès ✓', 'success');
        }
        
        function deleteFolder(catName, folderName) {
            if (!confirm('Supprimer "' + folderName + '" ?')) return;
            delete categories[catName][folderName];
            if (results[catName]) {
                delete results[catName][folderName];
                saveResults();
            }
            if (Object.keys(categories[catName]).length === 0) {
                delete categories[catName];
                delete openCategories[catName];
            }
            saveData();
            if (currentCategory === catName && currentFolder === folderName) showPage('home');
            updateCategoryList();
            showNotification('Cours supprimé ✓', 'success');
        }
        
        function showEditFolderModal(catName, folderName) {
            renameTarget = {cat: catName, folder: folderName};
            document.getElementById('renameFolderModal').classList.add('show');
            const input = document.getElementById('renameFolderInput');
            input.value = folderName;
            setTimeout(() => input.focus(), 150);
        }
        
        function closeRenameFolderModal() {
            document.getElementById('renameFolderModal').classList.remove('show');
            document.getElementById('renameFolderInput').value = '';
            renameTarget = null;
        }
        
        function showRenameFolderModal() {
            if (!currentCategory || !currentFolder) return;
            showEditFolderModal(currentCategory, currentFolder);
        }
        
        function renameFolder() {
            const input = document.getElementById('renameFolderInput');
            const newName = input.value.trim();
            if (!newName) {
                showNotification('Veuillez entrer un nom.', 'error');
                setTimeout(() => input.focus(), 150);
                return;
            }
            const catName = renameTarget.cat;
            const oldName = renameTarget.folder;
            if (categories[catName][newName] && newName !== oldName) {
                showNotification('Ce nom existe déjà.', 'error');
                input.value = '';
                setTimeout(() => input.focus(), 150);
                return;
            }
            if (categories[catName][oldName]) {
                categories[catName][newName] = categories[catName][oldName];
                delete categories[catName][oldName];
                if (results[catName] && results[catName][oldName]) {
                    results[catName][newName] = results[catName][oldName];
                    delete results[catName][oldName];
                    saveResults();
                }
                if (currentCategory === catName && currentFolder === oldName) currentFolder = newName;
                saveData();
                updateCategoryList();
                if (currentPage === 'lists') {
                    document.getElementById('listsTitle').textContent = newName;
                }
                closeRenameFolderModal();
                showNotification('Cours renommé ✓', 'success');
            }
        }
        
        function showNewListModal() {
            if (!currentCategory || !currentFolder) {
                showNotification('Erreur : aucun cours sélectionné.', 'error');
                return;
            }
            document.getElementById('newListModal').classList.add('show');
            const input = document.getElementById('listNameInput');
            input.value = '';
            setTimeout(() => input.focus(), 150);
        }
        
        function closeNewListModal() {
            document.getElementById('newListModal').classList.remove('show');
            document.getElementById('listNameInput').value = '';
        }
        
        function createList() {
            const input = document.getElementById('listNameInput');
            const name = input.value.trim();
            if (!name) {
                showNotification('Veuillez entrer un nom de liste.', 'error');
                setTimeout(() => input.focus(), 150);
                return;
            }
            if (!currentCategory || !currentFolder || !categories[currentCategory] || !categories[currentCategory][currentFolder]) {
                showNotification('Erreur.', 'error');
                return;
            }
            if (categories[currentCategory][currentFolder][name]) {
                showNotification('Cette liste existe déjà.', 'error');
                input.value = '';
                setTimeout(() => input.focus(), 150);
                return;
            }
            categories[currentCategory][currentFolder][name] = [];
            saveData();
            updateCategoryList();
            closeNewListModal();
            loadListsPage();
            showNotification('Liste créée avec succès ✓', 'success');
        }
        
        function deleteList(listName) {
            if (!confirm('Supprimer "' + listName + '" ?')) return;
            delete categories[currentCategory][currentFolder][listName];
            if (results[currentCategory] && results[currentCategory][currentFolder]) {
                delete results[currentCategory][currentFolder][listName];
                saveResults();
            }
            if (Object.keys(categories[currentCategory][currentFolder]).length === 0) {
                categories[currentCategory][currentFolder]['Liste par défaut'] = [];
            }
            saveData();
            updateCategoryList();
            loadListsPage();
            showNotification('Liste supprimée ✓', 'success');
        }
        
        function showEditListModal(listName) {
            renameTarget = listName;
            document.getElementById('renameListModal').classList.add('show');
            const input = document.getElementById('renameListInput');
            input.value = listName;
            setTimeout(() => input.focus(), 150);
        }
        
        function closeRenameListModal() {
            document.getElementById('renameListModal').classList.remove('show');
            document.getElementById('renameListInput').value = '';
            renameTarget = null;
        }
        
        function renameList() {
            const input = document.getElementById('renameListInput');
            const newName = input.value.trim();
            if (!newName) {
                showNotification('Veuillez entrer un nom.', 'error');
                setTimeout(() => input.focus(), 150);
                return;
            }
            if (!currentCategory || !currentFolder || !categories[currentCategory] || !categories[currentCategory][currentFolder]) {
                showNotification('Erreur.', 'error');
                return;
            }
            if (categories[currentCategory][currentFolder][newName] && newName !== renameTarget) {
                showNotification('Ce nom existe déjà.', 'error');
                input.value = '';
                setTimeout(() => input.focus(), 150);
                return;
            }
            if (renameTarget && categories[currentCategory][currentFolder][renameTarget]) {
                categories[currentCategory][currentFolder][newName] = categories[currentCategory][currentFolder][renameTarget];
                delete categories[currentCategory][currentFolder][renameTarget];
                if (results[currentCategory] && results[currentCategory][currentFolder] && results[currentCategory][currentFolder][renameTarget]) {
                    results[currentCategory][currentFolder][newName] = results[currentCategory][currentFolder][renameTarget];
                    delete results[currentCategory][currentFolder][renameTarget];
                    saveResults();
                }
                if (currentList === renameTarget) currentList = newName;
                saveData();
                updateCategoryList();
                loadListsPage();
                closeRenameListModal();
                showNotification('Liste renommée ✓', 'success');
            }
        }
        
        // ====== FONCTIONS DE GESTION DES CARTES ======
        function addCard() {
            const q = document.getElementById('newQuestion').innerHTML.trim();
            const a = document.getElementById('newAnswer').innerHTML.trim();
            const impEl = document.getElementById('importanceSelect');
            const importance = impEl ? (impEl.value || 'normal') : 'normal';
            if (!q || !a || q === '<br>' || a === '<br>') {
                showNotification('Veuillez remplir la question et la réponse.', 'error');
                return;
            }
            if (!currentCategory || !currentFolder || !currentList) {
                showNotification("Sélectionne d'abord une liste.", 'error');
                return;
            }
            categories[currentCategory][currentFolder][currentList].push({
                question: q,
                answer: a,
                importance: importance
            });
            saveData();
            document.getElementById('newQuestion').innerHTML = '';
            document.getElementById('newAnswer').innerHTML = '';
            if (impEl) impEl.value = 'normal';
            updateCategoryList();
            if (currentPage === 'manage') loadManageCardsPage();
            showNotification('Carte ajoutée avec succès ✓', 'success');
        }
        
        function deleteCard(idx) { 
            if (!confirm('Supprimer cette carte ?')) return; 
            categories[currentCategory][currentFolder][currentList].splice(idx, 1); 
            if (results[currentCategory] && results[currentCategory][currentFolder] && results[currentCategory][currentFolder][currentList]) { 
                delete results[currentCategory][currentFolder][currentList][idx]; 
                const newResults = {}; 
                Object.keys(results[currentCategory][currentFolder][currentList]).forEach(key => { 
                    const i = parseInt(key); 
                    if (i > idx) newResults[i - 1] = results[currentCategory][currentFolder][currentList][key]; 
                    else if (i < idx) newResults[i] = results[currentCategory][currentFolder][currentList][key]; 
                }); 
                results[currentCategory][currentFolder][currentList] = newResults; 
                saveResults(); 
            } 
            saveData(); 
            updateCategoryList(); 
            if (currentPage === 'manage') loadManageCardsPage();
            showNotification('Carte supprimée ✓', 'success');
        }
        
        function editCard(idx) {
            const card = categories[currentCategory][currentFolder][currentList][idx];
            const cardItem = document.querySelector(`.card-edit-item[data-index="${idx}"]`);
            
            if (cardItem.querySelector('.card-inline-editor')) {
                // Si l'éditeur est déjà ouvert, le fermer
                cardItem.querySelector('.card-inline-editor').remove();
                return;
            }
            
            const editor = document.createElement('div');
            editor.className = 'card-inline-editor';
            editor.innerHTML = `
                <div class="input-group">
                    <label>Question :</label>
                    <div class="editor-content" id="editQuestion${idx}" contenteditable="true">${card.question}</div>
                </div>
                <div class="input-group">
                    <label>Réponse :</label>
                    <div class="editor-content" id="editAnswer${idx}" contenteditable="true">${card.answer}</div>
                </div>
                <div class="input-group">
                    <label>Importance :</label>
                    <select id="editImportance${idx}">
                        <option value="important" ${card.importance === 'important' ? 'selected' : ''}>Important</option>
                        <option value="normal" ${card.importance === 'normal' ? 'selected' : ''}>Normal</option>
                        <option value="pas important" ${card.importance === 'pas important' ? 'selected' : ''}>Pas important</option>
                        <option value="explication" ${card.importance === 'explication' ? 'selected' : ''}>Explication</option>
                    </select>
                </div>
                <div class="actions">
                    <button class="btn-save-card" onclick="saveCardEdit(${idx})">Enregistrer</button>
                    <button class="btn-cancel-card" onclick="cancelCardEdit(${idx})">Annuler</button>
                </div>
            `;
            
            cardItem.appendChild(editor);
        }
        
        function saveCardEdit(idx) {
            const question = document.getElementById(`editQuestion${idx}`).innerHTML.trim();
            const answer = document.getElementById(`editAnswer${idx}`).innerHTML.trim();
            const importance = document.getElementById(`editImportance${idx}`).value;
            
            if (!question || !answer) {
                showNotification('Question et réponse sont requises.', 'error');
                return;
            }
            
            categories[currentCategory][currentFolder][currentList][idx] = {
                question: question,
                answer: answer,
                importance: importance
            };
            
            saveData();
            loadManageCardsPage();
            showNotification('Carte modifiée avec succès ✓', 'success');
        }
        
        function cancelCardEdit(idx) {
            loadManageCardsPage();
        }
        
        function loadManageCardsPage() {
            const cardsList = document.getElementById('cardsList');
            const cardCount = document.getElementById('cardCount');
            
            if (!currentCategory || !currentFolder || !currentList || !categories[currentCategory][currentFolder][currentList]) {
                cardsList.innerHTML = '<div class="empty-cards-message">Aucune carte dans cette liste</div>';
                cardCount.textContent = '0';
                return;
            }
            
            const cards = categories[currentCategory][currentFolder][currentList];
            cardCount.textContent = cards.length;
            
            if (cards.length === 0) {
                cardsList.innerHTML = '<div class="empty-cards-message">Aucune carte dans cette liste</div>';
                return;
            }
            
            cardsList.innerHTML = '';
            cards.forEach((card, idx) => {
                const cardItem = document.createElement('div');
                cardItem.className = 'card-edit-item';
                cardItem.setAttribute('data-index', idx);
                
                cardItem.innerHTML = `
                    <div class="card-edit-header">
                        <div class="card-edit-number">Carte #${idx + 1}</div>
                        <div>
                            <button class="btn-edit-card" onclick="editCard(${idx})">✏️</button>
                            <button class="btn-delete-card" onclick="deleteCard(${idx})">✕</button>
                        </div>
                    </div>
                    <div class="card-edit-content">
                        <div class="card-edit-text">
                            <span class="card-edit-label">Q:</span> ${card.question}
                        </div>
                        <div class="card-edit-text">
                            <span class="card-edit-label">R:</span> ${card.answer}
                        </div>
                        <div class="card-edit-text">
                            <span class="card-edit-label">Importance:</span> 
                            <span style="padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; 
                                ${card.importance === 'important' ? 'background: #10b98120; color: #10b981;' : 
                                card.importance === 'normal' ? 'background: #3b82f620; color: #3b82f6;' :
                                card.importance === 'pas important' ? 'background: #ef444420; color: #ef4444;' :
                                'background: #6b728020; color: #6b7280;'}">
                                ${card.importance}
                            </span>
                        </div>
                    </div>
                `;
                
                cardsList.appendChild(cardItem);
            });
        }
        
        // ====== FONCTIONS D'AFFICHAGE ======
        function showPage(pageName) {
            currentPage = pageName;
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageName + 'Page').classList.add('active');
            
            // Mettre à jour les éléments de navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (pageName === 'home') {
                document.querySelector('.nav-item:nth-child(1)').classList.add('active');
            } else if (pageName === 'publicUsers') {
                document.querySelector('.nav-item:nth-child(2)').classList.add('active');
            }
            
            // Charger les données de la page
            if (pageName === 'home') {
                updateHomeStats();
            } else if (pageName === 'lists') {
                loadListsPage();
            } else if (pageName === 'manage') {
                loadManageCardsPage();
            } else if (pageName === 'study') {
                loadStudyPage();
            }
        }
        
        function updateCategoryList() {
            const container = document.getElementById('categoryList');
            container.innerHTML = '';
            Object.keys(categories).forEach(catName => {
                const catDiv = document.createElement('div');
                catDiv.className = 'category-item';
                const catHeader = document.createElement('div');
                catHeader.className = 'category-header';
                if (catName === currentCategory && (currentPage === 'lists' || currentPage === 'study' || currentPage === 'manage')) {
                    catHeader.classList.add('active');
                }
               
                let totalCards = 0;
                Object.values(categories[catName]).forEach(folder => {
                    Object.values(folder).forEach(lists => {
                        totalCards += lists.length;
                    });
                });
               
                const leftDiv = document.createElement('div');
                leftDiv.className = 'category-left';
                const isOpen = openCategories[catName];
                const toggleSpan = document.createElement('span');
                toggleSpan.className = 'category-toggle' + (isOpen ? ' open' : '');
                toggleSpan.innerHTML = '▶';
                toggleSpan.onclick = function(e) { e.stopPropagation(); toggleCategory(catName); };
                const nameSpan = document.createElement('span');
                nameSpan.className = 'category-name';
                nameSpan.textContent = catName;
                const countSpan = document.createElement('span');
                countSpan.className = 'category-count';
                countSpan.textContent = totalCards;
                leftDiv.appendChild(toggleSpan);
                leftDiv.appendChild(nameSpan);
                leftDiv.appendChild(countSpan);
               
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'category-actions';
                const editBtn = document.createElement('button');
                editBtn.className = 'btn-edit-category';
                editBtn.innerHTML = '✏️';
                editBtn.onclick = function(e) { e.stopPropagation(); showEditCategoryModal(catName); };
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn-delete-category';
                deleteBtn.innerHTML = '✕';
                deleteBtn.onclick = function(e) { e.stopPropagation(); deleteCategory(catName); };
                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);
               
                catHeader.appendChild(leftDiv);
                catHeader.appendChild(actionsDiv);
                catDiv.appendChild(catHeader);
               
                const foldersDiv = document.createElement('div');
                foldersDiv.className = 'category-folders' + (isOpen ? ' open' : '');
               
                Object.keys(categories[catName]).forEach(folderName => {
                    let cardCount = 0;
                    Object.values(categories[catName][folderName]).forEach(lists => {
                        cardCount += lists.length;
                    });
                   
                    const folderDiv = document.createElement('div');
                    folderDiv.className = 'folder-item';
                    if (catName === currentCategory && folderName === currentFolder && (currentPage === 'lists' || currentPage === 'study' || currentPage === 'manage')) {
                        folderDiv.classList.add('active');
                    }
                   
                    const folderInfo = document.createElement('div');
                    folderInfo.className = 'folder-info';
                    folderInfo.onclick = function() { showListsPage(catName, folderName); };
                    folderInfo.innerHTML = '<span>📖</span><span style="flex:1">' + escapeHtml(folderName) + '</span><span class="folder-badge">' + cardCount + '</span>';
                   
                    const folderActions = document.createElement('div');
                    folderActions.className = 'folder-actions';
                    const folderEditBtn = document.createElement('button');
                    folderEditBtn.className = 'btn-edit-folder';
                    folderEditBtn.innerHTML = '✏️';
                    folderEditBtn.onclick = function(e) { e.stopPropagation(); showEditFolderModal(catName, folderName); };
                    const folderDeleteBtn = document.createElement('button');
                    folderDeleteBtn.className = 'btn-delete-folder';
                    folderDeleteBtn.innerHTML = '✕';
                    folderDeleteBtn.onclick = function(e) { e.stopPropagation(); deleteFolder(catName, folderName); };
                    folderActions.appendChild(folderEditBtn);
                    folderActions.appendChild(folderDeleteBtn);
                   
                    folderDiv.appendChild(folderInfo);
                    folderDiv.appendChild(folderActions);
                    foldersDiv.appendChild(folderDiv);
                });
               
                catDiv.appendChild(foldersDiv);
                container.appendChild(catDiv);
            });
        }
        
        function escapeHtml(text) { 
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' }; 
            return text.replace(/[&<>"']/g, m => map[m]); 
        }
        
        function updateHomeStats() { 
            let totalCourses = 0; 
            let totalCards = 0; 
            Object.values(categories).forEach(cat => { 
                Object.values(cat).forEach(folder => { 
                    totalCourses++; 
                    Object.values(folder).forEach(lists => { 
                        totalCards += lists.length; 
                    }); 
                }); 
            }); 
            document.getElementById('totalCourses').textContent = totalCourses; 
            document.getElementById('totalCards').textContent = totalCards; 
            const list = document.getElementById('courseList'); 
            list.innerHTML = ''; 
            if (totalCourses === 0) { 
                list.innerHTML = '<p style="color:#999;text-align:center;padding:20px">Aucun cours créé.</p>'; 
                return; 
            } 
            Object.keys(categories).forEach(catName => { 
                Object.keys(categories[catName]).forEach(folderName => { 
                    let cardCount = 0; 
                    const listCount = Object.keys(categories[catName][folderName]).length; 
                    Object.values(categories[catName][folderName]).forEach(lists => { 
                        cardCount += lists.length; 
                    }); 
                    const div = document.createElement('div'); 
                    div.className = 'course-card'; 
                    div.onclick = () => showListsPage(catName, folderName); 
                    div.innerHTML = '<div class="course-card-left"><div class="course-card-title">' + escapeHtml(folderName) + '</div><div class="course-card-info">' + listCount + ' liste' + (listCount > 1 ? 's' : '') + ' • ' + cardCount + ' carte' + (cardCount > 1 ? 's' : '') + '</div></div><div class="course-card-arrow">→</div>'; 
                    list.appendChild(div); 
                }); 
            }); 
        }
        
        function showListsPage(catName, folderName) {
            currentCategory = catName;
            currentFolder = folderName;
            currentPage = 'lists';
            
            // Mettre à jour la barre latérale
            updateCategoryList();
            
            // Mettre à jour le titre
            const title = document.getElementById('listsTitle');
            if (title) {
                title.textContent = folderName;
            }
            
            // Charger les listes
            loadListsPage();
            
            // Afficher la page
            showPage('lists');
        }
        
        function loadListsPage() {
            const container = document.getElementById('listsGrid');
            container.innerHTML = '';
            if (!currentCategory || !currentFolder || !categories[currentCategory] || !categories[currentCategory][currentFolder]) return;
            const lists = categories[currentCategory][currentFolder];
            Object.keys(lists).forEach(listName => {
                const cards = lists[listName];
                const cardCount = cards.length;
                let toReviewCount = 0;
                if (results[currentCategory] && results[currentCategory][currentFolder] && results[currentCategory][currentFolder][listName]) {
                    const listResults = results[currentCategory][currentFolder][listName];
                    Object.values(listResults).forEach(result => {
                        if (result === 'partial' || result === 'unknown') toReviewCount++;
                    });
                }
               
                const card = document.createElement('div');
                card.className = 'list-card';
               
                const buttonsDiv = document.createElement('div');
                buttonsDiv.className = 'list-card-buttons';
                const editBtn = document.createElement('button');
                editBtn.className = 'btn-edit-list';
                editBtn.innerHTML = '✏️';
                editBtn.onclick = function(e) { e.stopPropagation(); showEditListModal(listName); };
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn-delete-list';
                deleteBtn.innerHTML = '✕';
                deleteBtn.onclick = function(e) { e.stopPropagation(); deleteList(listName); };
                buttonsDiv.appendChild(editBtn);
                buttonsDiv.appendChild(deleteBtn);
               
                const integrateBtn = document.createElement('button');
                integrateBtn.className = 'btn-edit-list';
                integrateBtn.title = 'Intégrer cette liste';
                integrateBtn.textContent = '🔗';
                integrateBtn.onclick = function(e) {
                    e.stopPropagation();
                    copyListEmbed(listName);
                };
                buttonsDiv.appendChild(integrateBtn);
               
                let progressHTML = '';
                if (toReviewCount > 0) {
                    progressHTML = '<div class="list-card-progress">🔄 ' + toReviewCount + ' à revoir</div>';
                }
               
                card.innerHTML = '<div class="list-card-left"><div class="list-card-title">' + escapeHtml(listName) + '</div><div class="list-card-count">' + cardCount + ' carte' + (cardCount > 1 ? 's' : '') + '</div>' + progressHTML + '</div><div class="list-card-actions"><button class="btn-list-action btn-study" onclick="showStudyPage(\'' + escapeHtml(currentCategory).replace(/'/g, "\\'") + '\',\'' + escapeHtml(currentFolder).replace(/'/g, "\\'") + '\',\'' + escapeHtml(listName).replace(/'/g, "\\'") + '\')">📖 Réviser</button><button class="btn-list-action btn-manage" onclick="showManageCardsPage(\'' + escapeHtml(currentCategory).replace(/'/g, "\\'") + '\',\'' + escapeHtml(currentFolder).replace(/'/g, "\\'") + '\',\'' + escapeHtml(listName).replace(/'/g, "\\'") + '\')">✏️ Gérer</button></div>';
                card.appendChild(buttonsDiv);
                container.appendChild(card);
            });
        }
        
        function showManageCardsPage(catName, folderName, listName) {
            currentCategory = catName;
            currentFolder = folderName;
            currentList = listName;
            currentPage = 'manage';
            
            // Mettre à jour la barre latérale
            updateCategoryList();
            
            // Mettre à jour le titre
            const title = document.getElementById('manageTitle');
            if (title) {
                title.textContent = listName;
            }
            
            // Configurer le bouton retour
            document.getElementById('backToLists').onclick = () => showListsPage(catName, folderName);
            
            // Charger les cartes
            loadManageCardsPage();
            
            // Afficher la page
            showPage('manage');
        }
        
        function showStudyPage(catName, folderName, listName) {
            currentCategory = catName;
            currentFolder = folderName;
            currentList = listName;
            currentPage = 'study';
            
            // Mettre à jour la barre latérale
            updateCategoryList();
            
            // Configurer le bouton retour
            document.getElementById('backToListsStudy').onclick = () => showListsPage(catName, folderName);
            
            // Charger la page d'étude
            loadStudyPage();
            
            // Afficher la page
            showPage('study');
        }
        
        function loadStudyPage() {
            if (!currentCategory || !currentFolder || !currentList) return;
            
            const cards = categories[currentCategory][currentFolder][currentList];
            document.getElementById('studyTitle').textContent = currentList;
            
            if (!cards || cards.length === 0) {
                document.getElementById('cardSection').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
                document.getElementById('endSection').style.display = 'none';
                return;
            }
            
            document.getElementById('cardSection').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('endSection').style.display = 'none';
            
            // Réinitialiser les variables d'étude
            currentIndex = 0;
            isFlipped = false;
            stats = {known: 0, partial: 0, unknown: 0};
            
            // Filtrer les cartes si nécessaire
            let studyCards = [...cards];
            if (window.activeImportanceFilter && window.activeImportanceFilter.length > 0) {
                studyCards = studyCards.filter(card => 
                    window.activeImportanceFilter.includes(card.importance)
                );
            }
            
            if (studyCards.length === 0) {
                document.getElementById('cardSection').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
                return;
            }
            
            // Mélanger les cartes
            studyCards = shuffleArray(studyCards);
            
            // Sauvegarder les cartes pour l'étude
            window.studyCards = studyCards;
            
            // Afficher la première carte
            showCard();
        }
        
        function showCard() {
            if (!window.studyCards || currentIndex >= window.studyCards.length) {
                endStudy();
                return;
            }
            
            const card = window.studyCards[currentIndex];
            const flashcard = document.getElementById('flashcard');
            
            // Réinitialiser la rotation de la carte
            flashcard.classList.remove('flipped');
            isFlipped = false;
            
            // Mettre à jour le contenu
            document.getElementById('question').innerHTML = card.question;
            document.getElementById('answer').innerHTML = card.answer;
            
            // Mettre à jour les statistiques
            updateStats();
        }
        
        function flipCard() {
            const flashcard = document.getElementById('flashcard');
            flashcard.classList.toggle('flipped');
            isFlipped = !isFlipped;
        }
        
        function answer(type) {
            if (!window.studyCards || currentIndex >= window.studyCards.length) return;
            
            // Enregistrer la réponse
            stats[type]++;
            
            // Enregistrer dans les résultats si l'utilisateur n'est pas invité
            if (currentUser && !currentUser.guest) {
                if (!results[currentCategory]) results[currentCategory] = {};
                if (!results[currentCategory][currentFolder]) results[currentCategory][currentFolder] = {};
                if (!results[currentCategory][currentFolder][currentList]) results[currentCategory][currentFolder][currentList] = {};
                results[currentCategory][currentFolder][currentList][currentIndex] = type;
                saveResults();
            }
            
            // Passer à la carte suivante
            currentIndex++;
            
            if (currentIndex < window.studyCards.length) {
                showCard();
            } else {
                endStudy();
            }
        }
        
        function updateStats() {
            const total = window.studyCards.length;
            const done = currentIndex;
            const progress = total > 0 ? (done / total) * 100 : 0;
            
            document.getElementById('stats').innerHTML = `
                ${done + 1}/${total} cartes • 
                ✓ ${stats.known} • ~ ${stats.partial} • ✗ ${stats.unknown}
            `;
            
            document.querySelector('.progress-fill').style.width = `${progress}%`;
        }
        
        function endStudy() {
            document.getElementById('cardSection').style.display = 'none';
            document.getElementById('endSection').style.display = 'block';
            
            const total = window.studyCards.length;
            const knownPercent = total > 0 ? Math.round((stats.known / total) * 100) : 0;
            const partialPercent = total > 0 ? Math.round((stats.partial / total) * 100) : 0;
            const unknownPercent = total > 0 ? Math.round((stats.unknown / total) * 100) : 0;
            
            document.getElementById('legendKnown').textContent = `Connu: ${stats.known} (${knownPercent}%)`;
            document.getElementById('legendPartial').textContent = `Partiel: ${stats.partial} (${partialPercent}%)`;
            document.getElementById('legendUnknown').textContent = `Pas connu: ${stats.unknown} (${unknownPercent}%)`;
            
            document.getElementById('barKnown').style.width = `${knownPercent}%`;
            document.getElementById('barPartial').style.width = `${partialPercent}%`;
            document.getElementById('barUnknown').style.width = `${unknownPercent}%`;
            
            // Afficher un GIF de félicitations si le score est bon
            if (knownPercent >= 80) {
                document.getElementById('resultGifImg').src = GIF_KNOWN_URL;
                document.getElementById('resultGif').classList.add('show');
            }
        }
        
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        // ====== FONCTIONS DU MODE PLEIN ÉCRAN ======
        let fullscreenIndex = 0;
        let fullscreenCards = [];
        let fullscreenReviewMode = false;
        let fullscreenReviewIndices = [];

        function openFullscreenStudy() {
            if (!currentCategory || !currentFolder || !currentList) {
                showNotification('Sélectionnez d\'abord une liste', 'error');
                return;
            }
            
            const cards = categories[currentCategory][currentFolder][currentList];
            if (!cards || cards.length === 0) {
                showNotification('Cette liste est vide', 'error');
                return;
            }
            
            // Filtrer les cartes si un filtre d'importance est actif
            if (window.activeImportanceFilter && window.activeImportanceFilter.length > 0) {
                fullscreenCards = cards.filter(card => 
                    window.activeImportanceFilter.includes(card.importance)
                );
            } else {
                fullscreenCards = [...cards];
            }
            
            if (fullscreenCards.length === 0) {
                showNotification('Aucune carte ne correspond au filtre', 'error');
                return;
            }
            
            // Mélanger les cartes
            fullscreenCards = shuffleArray([...fullscreenCards]);
            
            // Réinitialiser l'index
            fullscreenIndex = 0;
            
            // Afficher la première carte
            showFullscreenCard();
            
            // Activer le mode plein écran
            document.getElementById('fullscreenMode').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function showFullscreenCard() {
            if (fullscreenIndex >= fullscreenCards.length) {
                // Fin de la session
                exitFullscreen();
                showNotification('Session terminée !', 'success');
                return;
            }
            
            const card = fullscreenCards[fullscreenIndex];
            document.getElementById('fullscreenQuestion').innerHTML = card.question;
            document.getElementById('fullscreenAnswer').innerHTML = card.answer;
            
            // Réinitialiser la rotation de la carte
            const fullscreenCard = document.getElementById('fullscreenCard');
            fullscreenCard.classList.remove('flipped');
        }

        function flipFullscreenCard() {
            const card = document.getElementById('fullscreenCard');
            card.classList.toggle('flipped');
        }

        function fullscreenAnswer(type) {
            // Enregistrer la réponse
            const card = fullscreenCards[fullscreenIndex];
            
            // Enregistrer dans les résultats si l'utilisateur n'est pas invité
            if (currentUser && !currentUser.guest) {
                if (!results[currentCategory]) results[currentCategory] = {};
                if (!results[currentCategory][currentFolder]) results[currentCategory][currentFolder] = {};
                if (!results[currentCategory][currentFolder][currentList]) results[currentCategory][currentFolder][currentList] = {};
                results[currentCategory][currentFolder][currentList][fullscreenIndex] = type;
                saveResults();
            }
            
            // Passer à la carte suivante
            fullscreenIndex++;
            
            // Afficher la prochaine carte
            showFullscreenCard();
        }

        function exitFullscreen() {
            document.getElementById('fullscreenMode').classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Rafraîchir l'affichage normal si on était en mode étude
            if (currentPage === 'study') {
                loadStudyPage();
            }
        }
        
        // ====== FONCTIONS D'IMPORT/EXPORT ======
        function importCards() {
            document.getElementById('fileInput').click();
            document.getElementById('fileInput').onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        // Demander où importer
                        if (confirm('Voulez-vous importer ces données dans un nouveau cours ?')) {
                            const courseName = prompt('Nom du nouveau cours :', 'Cours importé');
                            if (courseName) {
                                if (!categories['📚 Importés']) {
                                    categories['📚 Importés'] = {};
                                }
                                categories['📚 Importés'][courseName] = data;
                                saveData();
                                updateCategoryList();
                                showNotification('Cours importé avec succès ✓', 'success');
                            }
                        }
                    } catch (error) {
                        showNotification('Erreur lors de l\'import : fichier invalide', 'error');
                    }
                };
                reader.readAsText(file);
            };
        }
        
        function exportAll() {
            const dataStr = JSON.stringify(categories, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'flashcards_export.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Toutes les données ont été exportées ✓', 'success');
        }
        
        function exportCards() {
            if (!currentCategory || !currentFolder || !currentList) {
                showNotification('Sélectionnez d\'abord une liste', 'error');
                return;
            }
            
            const cards = categories[currentCategory][currentFolder][currentList];
            const dataStr = JSON.stringify(cards, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `${currentFolder}_${currentList}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Cartes exportées avec succès ✓', 'success');
        }
        
        function clearCurrentList() {
            if (!currentCategory || !currentFolder || !currentList) {
                showNotification('Sélectionnez d\'abord une liste', 'error');
                return;
            }
            
            if (confirm(`Voulez-vous vraiment supprimer toutes les cartes de "${currentList}" ?`)) {
                categories[currentCategory][currentFolder][currentList] = [];
                saveData();
                loadManageCardsPage();
                showNotification('Liste vidée avec succès ✓', 'success');
            }
        }
        
        // ====== FONCTIONS D'ÉDITION ======
        function execFormatCommand(command) {
            document.execCommand(command, false, null);
        }
        
        function applyColorToSelection(command, color) {
            document.execCommand(command, false, color);
        }
        
        function insertImage() {
            document.getElementById('imageInput').click();
            document.getElementById('imageInput').onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.maxWidth = '200px';
                    img.style.height = 'auto';
                    document.execCommand('insertHTML', false, img.outerHTML);
                };
                reader.readAsDataURL(file);
            };
        }
        
        function clearFormatNow() {
            document.execCommand('removeFormat', false, null);
        }
        
        // ====== FONCTIONS DU THÈME ======
        const THEME_KEY = 'flashcards_theme_v2';
        const themeConfig = {
            sections: {
                'primary': {
                    title: '🎨 Couleurs principales',
                    colors: [
                        { var: '--primary', label: 'Primaire', description: 'Boutons principaux, liens' },
                        { var: '--primary-2', label: 'Primaire 2', description: 'Dégradé des boutons' },
                        { var: '--accent', label: 'Accent', description: 'Éléments secondaires' },
                        { var: '--accent-2', label: 'Accent 2', description: 'Dégradé des accents' }
                    ]
                },
                'interface': {
                    title: '📝 Interface et texte',
                    colors: [
                        { var: '--bg-gradient-from', label: 'Fond départ', description: 'Début du dégradé' },
                        { var: '--bg-gradient-to', label: 'Fond fin', description: 'Fin du dégradé' },
                        { var: '--text', label: 'Texte', description: 'Texte principal' },
                        { var: '--text-soft', label: 'Texte secondaire', description: 'Texte atténué' },
                        { var: '--panel', label: 'Panneau', description: 'Fond des cartes' },
                        { var: '--panel-muted', label: 'Panneau atténué', description: 'Fond secondaire' },
                        { var: '--border', label: 'Bordures', description: 'Bordures et séparateurs' },
                        { var: '--card-bg', label: 'Cartes étude', description: 'Fond des flashcards' }
                    ]
                },
                'progress': {
                    title: '📊 Couleurs de progression',
                    colors: [
                        { var: '--known', label: 'Connu', description: 'Cartes connues' },
                        { var: '--partial', label: 'Partiel', description: 'Cartes partiellement connues' },
                        { var: '--unknown', label: 'Pas connu', description: 'Cartes non connues' }
                    ]
                }
            },
            presets: {
                'Classique': {
                    '--bg-gradient-from': '#667eea',
                    '--bg-gradient-to': '#764ba2',
                    '--primary': '#667eea',
                    '--primary-2': '#764ba2',
                    '--accent': '#11998e',
                    '--accent-2': '#38ef7d',
                    '--text': '#333333',
                    '--text-soft': '#666666',
                    '--panel': '#ffffff',
                    '--panel-muted': '#f5f7fa',
                    '--border': '#e0e0e0',
                    '--card-bg': '#ffffff',
                    '--known': '#38ef7d',
                    '--partial': '#f5a623',
                    '--unknown': '#ff6b6b'
                },
                'Sombre': {
                    '--bg-gradient-from': '#0f172a',
                    '--bg-gradient-to': '#1f2937',
                    '--primary': '#4f46e5',
                    '--primary-2': '#7c3aed',
                    '--accent': '#10b981',
                    '--accent-2': '#34d399',
                    '--text': '#e5e7eb',
                    '--text-soft': '#9ca3af',
                    '--panel': '#111827',
                    '--panel-muted': '#0b1220',
                    '--border': '#374151',
                    '--card-bg': '#0b1220',
                    '--known': '#22c55e',
                    '--partial': '#f59e0b',
                    '--unknown': '#ef4444'
                }
            }
        };
        
        function setVar(name, value) {
            document.documentElement.style.setProperty(name, value);
        }
        
        function getComputedVar(name) {
            return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        }
        
        function openThemeModal() {
            const modal = document.getElementById('themeModal');
            if (!modal) {
                console.error('Theme modal not found');
                return;
            }
            modal.classList.add('show');
            
            // Initialiser les couleurs
            const presetsContainer = document.getElementById('themePresets');
            if (presetsContainer) {
                presetsContainer.innerHTML = '';
                
                Object.entries(themeConfig.presets).forEach(([name, colors]) => {
                    const btn = document.createElement('button');
                    btn.className = 'preset-btn';
                    btn.innerHTML = `
                        <div class="preset-preview" style="background: linear-gradient(135deg, ${colors['--bg-gradient-from']} 0%, ${colors['--bg-gradient-to']} 100%);"></div>
                        <span>${name}</span>
                    `;
                    btn.onclick = () => applyPreset(name);
                    presetsContainer.appendChild(btn);
                });
            }
            
            // Initialiser les sélecteurs de couleur
            Object.entries(themeConfig.sections).forEach(([sectionId, section]) => {
                const container = document.getElementById(sectionId + 'Colors');
                if (!container) return;
                
                container.innerHTML = '';
                section.colors.forEach(color => {
                    const currentValue = getComputedVar(color.var);
                    const hexValue = rgbToHex(currentValue);
                    
                    const colorOption = document.createElement('div');
                    colorOption.className = 'color-option';
                    colorOption.innerHTML = `
                        <div class="color-label">
                            <span>${color.label}</span>
                            <small>${color.description}</small>
                        </div>
                        <div class="color-input-wrapper">
                            <div class="color-preview" style="background: ${currentValue}" 
                                 onclick="document.getElementById('${color.var}').click()"></div>
                            <input type="color" id="${color.var}" value="${hexValue}" 
                                   oninput="updateColor('${color.var}', this.value)">
                            <input type="text" value="${hexValue}" 
                                   oninput="updateColor('${color.var}', this.value)">
                        </div>
                    `;
                    container.appendChild(colorOption);
                });
            });
        }
        
        function updateColor(varName, value) {
            if (!value.startsWith('#')) value = '#' + value;
            if (/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(value)) {
                setVar(varName, value);
                
                const preview = document.querySelector(`#${varName}`).parentElement.querySelector('.color-preview');
                preview.style.background = value;
                
                const textInput = document.querySelector(`#${varName}`).nextElementSibling;
                textInput.value = value;
            }
        }
        
        function applyPreset(name) {
            const preset = themeConfig.presets[name];
            if (!preset) return;
            
            Object.entries(preset).forEach(([varName, value]) => {
                setVar(varName, value);
                
                const colorInput = document.getElementById(varName);
                const textInput = colorInput?.nextElementSibling;
                const preview = colorInput?.parentElement?.querySelector('.color-preview');
                
                if (colorInput) colorInput.value = value;
                if (textInput) textInput.value = value;
                if (preview) preview.style.background = value;
            });
            
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(name)) {
                    btn.classList.add('active');
                }
            });
        }
        
        function saveTheme() {
            const theme = {};
            
            Object.values(themeConfig.sections).forEach(section => {
                section.colors.forEach(color => {
                    const input = document.getElementById(color.var);
                    if (input && input.value) {
                        theme[color.var] = input.value;
                    }
                });
            });
            
            localStorage.setItem(THEME_KEY, JSON.stringify(theme));
            showNotification('✅ Thème enregistré !', 'success');
        }
        
        function loadTheme() {
            try {
                const saved = localStorage.getItem(THEME_KEY);
                if (!saved) {
                    applyPreset('Classique');
                    return;
                }
                
                const theme = JSON.parse(saved);
                Object.entries(theme).forEach(([varName, value]) => {
                    setVar(varName, value);
                });
            } catch (e) {
                console.warn('Erreur chargement thème:', e);
                applyPreset('Classique');
            }
        }
        
        function resetTheme() {
            if (confirm('Êtes-vous sûr de vouloir réinitialiser le thème ?')) {
                localStorage.removeItem(THEME_KEY);
                applyPreset('Classique');
                showNotification('🔄 Thème réinitialisé !', 'success');
            }
        }
        
        function closeThemeModal() {
            document.getElementById('themeModal').classList.remove('show');
        }
        
        function rgbToHex(rgb) {
            // Si c'est déjà en hex, retourner la valeur
            if (rgb.startsWith('#')) return rgb;
            
            // Convertir rgb(r, g, b) en hex
            const match = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.?\d*))?\)$/);
            if (match) {
                const r = parseInt(match[1]);
                const g = parseInt(match[2]);
                const b = parseInt(match[3]);
                return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
            }
            
            // Par défaut
            return '#667eea';
        }
        
        // ====== FONCTIONS DU COMPARATEUR ======
        function openComparator() {
            document.getElementById('comparatorModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }
        
        function closeComparator() {
            document.getElementById('comparatorModal').classList.remove('show');
            document.body.style.overflow = 'auto';
        }
        
        // ====== FONCTIONS UTILITAIRES ======
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const toggleBtn = document.getElementById('toggleSidebarBtn');
            
            sidebar.classList.toggle('hidden');
            mainContent.classList.toggle('sidebar-hidden');
            toggleBtn.classList.toggle('sidebar-hidden');
        }
        
        function copyFolderEmbed() {
            if (!currentCategory || !currentFolder) return;
            
            const embedCode = `<iframe src="${window.location.origin}${window.location.pathname}?folder=${encodeURIComponent(currentCategory)}|${encodeURIComponent(currentFolder)}" width="100%" height="600"></iframe>`;
            
            navigator.clipboard.writeText(embedCode).then(() => {
                showNotification('Code d\'intégration copié !', 'success');
            }).catch(err => {
                console.error('Erreur de copie :', err);
                showNotification('Erreur lors de la copie', 'error');
            });
        }
        
        function copyListEmbed(listName) {
            if (!currentCategory || !currentFolder || !listName) return;
            
            const embedCode = `<iframe src="${window.location.origin}${window.location.pathname}?list=${encodeURIComponent(currentCategory)}|${encodeURIComponent(currentFolder)}|${encodeURIComponent(listName)}" width="100%" height="600"></iframe>`;
            
            navigator.clipboard.writeText(embedCode).then(() => {
                showNotification('Code d\'intégration copié !', 'success');
            }).catch(err => {
                console.error('Erreur de copie :', err);
                showNotification('Erreur lors de la copie', 'error');
            });
        }
        
        function searchUsers() {
            const searchTerm = document.getElementById('userSearchInput').value.toLowerCase().trim();
            const resultsDiv = document.getElementById('userSearchResults');
            resultsDiv.innerHTML = '';
            
            if (!searchTerm) return;
            
            const matchedUsers = Object.keys(allUsers).filter(username => {
                if (username === currentUser.username) return false;
                if (!allUsers[username].publicProfile) return false;
                return username.toLowerCase().includes(searchTerm);
            });
            
            if (matchedUsers.length === 0) {
                resultsDiv.innerHTML = '<div style="color: var(--text-soft); padding: 10px; text-align: center;">Aucun utilisateur trouvé</div>';
                return;
            }
            
            matchedUsers.slice(0, 5).forEach(username => {
                const user = allUsers[username];
                const userDiv = document.createElement('div');
                userDiv.className = 'user-result';
                
                let avatarContent = username.charAt(0).toUpperCase();
                if (user.avatar) {
                    avatarContent = `<img src="${user.avatar}" alt="${username}">`;
                }
                
                userDiv.innerHTML = `
                    <div class="user-result-avatar">${avatarContent}</div>
                    <div class="user-result-info">
                        <div class="user-result-name">${username}</div>
                        <div class="user-result-stats">
                            ${Object.keys(user.folders || {}).length} cours
                        </div>
                    </div>
                `;
                
                userDiv.onclick = () => viewUserProfile(username);
                resultsDiv.appendChild(userDiv);
            });
        }
        
        // ====== INITIALISATION ======
        document.addEventListener('DOMContentLoaded', function() {
            loadUsers();
            checkAuth();
            
            // Fermer les dropdowns en cliquant à l'extérieur
            document.addEventListener('click', function(e) {
                const profileDropdown = document.getElementById('profileDropdown');
                if (profileDropdown && profileDropdown.classList.contains('active') && 
                    !e.target.closest('.nav-profile') && !e.target.closest('.profile-dropdown')) {
                    profileDropdown.classList.remove('active');
                }
            });
            
            // Ajouter les écouteurs d'événements pour les modals
            document.getElementById('categoryNameInput')?.addEventListener('keypress', function(e) { 
                if (e.key === 'Enter') createCategory(); 
            });
            document.getElementById('folderNameInput')?.addEventListener('keypress', function(e) { 
                if (e.key === 'Enter') createFolder(); 
            });
            document.getElementById('listNameInput')?.addEventListener('keypress', function(e) { 
                if (e.key === 'Enter') createList(); 
            });
            document.getElementById('renameCategoryInput')?.addEventListener('keypress', function(e) { 
                if (e.key === 'Enter') renameCategory(); 
            });
            document.getElementById('renameFolderInput')?.addEventListener('keypress', function(e) { 
                if (e.key === 'Enter') renameFolder(); 
            });
            document.getElementById('renameListInput')?.addEventListener('keypress', function(e) { 
                if (e.key === 'Enter') renameList(); 
            });
            
            // Fermer les modals en cliquant à l'extérieur
            document.getElementById('newCategoryModal')?.addEventListener('click', function(e) { 
                if (e.target === this) closeNewCategoryModal(); 
            });
            document.getElementById('newFolderModal')?.addEventListener('click', function(e) { 
                if (e.target === this) closeNewFolderModal(); 
            });
            document.getElementById('newListModal')?.addEventListener('click', function(e) { 
                if (e.target === this) closeNewListModal(); 
            });
            document.getElementById('renameCategoryModal')?.addEventListener('click', function(e) { 
                if (e.target === this) closeRenameCategoryModal(); 
            });
            document.getElementById('renameFolderModal')?.addEventListener('click', function(e) { 
                if (e.target === this) closeRenameFolderModal(); 
            });
            document.getElementById('renameListModal')?.addEventListener('click', function(e) { 
                if (e.target === this) closeRenameListModal(); 
            });
            document.getElementById('profileSettingsModal')?.addEventListener('click', function(e) { 
                if (e.target === this) closeProfileSettings(); 
            });
            document.getElementById('userProfileModal')?.addEventListener('click', function(e) { 
                if (e.target === this) closeUserProfileModal(); 
            });
            document.getElementById('publicCourseModal')?.addEventListener('click', function(e) { 
                if (e.target === this) closePublicCourseModal(); 
            });
            
            // Fermer les modals en cliquant à l'extérieur
            document.addEventListener('click', function(e) {
                // Modal thème
                const themeModal = document.getElementById('themeModal');
                if (themeModal && themeModal.classList.contains('show') && e.target === themeModal) {
                    themeModal.classList.remove('show');
                }
                
                // Modal import texte
                const importModal = document.getElementById('importTextModal');
                if (importModal && importModal.classList.contains('show') && e.target === importModal) {
                    closeImportTextModal();
                }
            });
        });
    </script>
</body>
</html>
