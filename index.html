<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards + Comparateur</title>
    <script src="https://cdn.jsdelivr.net/npm/diff@5.1.0/dist/diff.min.js"></script>
    <style>
        /* --- 1. VARIABLES DE COULEURS (Modifiables) --- */
        :root {
            /* Couleurs principales (D√©grad√© violet par d√©faut) */
            --primary-color-start: #667eea;
            --primary-color-end: #764ba2;
            
            /* Couleurs secondaires (Vert/Turquoise par d√©faut) */
            --secondary-color-start: #11998e;
            --secondary-color-end: #38ef7d;

            /* Autres */
            --sidebar-bg: #ffffff;
            --text-main: #333333;
            --bg-body: #f0f2f5; 
        }

        /* --- 2. CSS INITIAL (Adapt√© avec variables) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg-body); /* Chang√© pour une couleur unie ou d√©grad√© global */
            min-height: 100vh; 
            display: flex; 
        }
        
        /* MENU FIXE (Modifi√© pour rester fixe) */
        .sidebar { 
            width: 280px; 
            background: var(--sidebar-bg); 
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1); 
            display: flex; 
            flex-direction: column; 
            position: fixed; 
            height: 100vh; 
            left: 0; 
            top: 0; 
            z-index: 100; 
            /* Pas de transition de masquage */
        }

        .sidebar-header { 
            padding: 30px 20px; 
            background: linear-gradient(135deg, var(--primary-color-start) 0%, var(--primary-color-end) 100%); 
            color: white; 
        }
        .sidebar-header h1 { font-size: 22px; margin-bottom: 5px; }
        .sidebar-header p { font-size: 13px; opacity: 0.9; }
        
        .sidebar-nav { padding: 20px; border-bottom: 2px solid #e0e0e0; }
        .nav-item { padding: 12px 15px; margin-bottom: 8px; border-radius: 8px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 10px; font-weight: 500; color: var(--text-main); }
        .nav-item:hover { background: #f5f7fa; }
        .nav-item.active { 
            background: linear-gradient(135deg, var(--primary-color-start) 0%, var(--primary-color-end) 100%); 
            color: white; 
        }

        .folder-section { flex: 1; overflow-y: auto; padding: 20px; }
        .folder-section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .folder-section-header h3 { font-size: 14px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; }
        .folder-section-buttons { display: flex; gap: 5px; }
        
        .btn-new-folder, .btn-new-category { 
            background: var(--primary-color-start); 
            color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.3s; 
        }
        .btn-new-category { background: var(--secondary-color-start); }
        
        /* Contenu Principal d√©cal√© pour le menu fixe */
        .main-content { 
            margin-left: 280px; 
            flex: 1; 
            padding: 40px; 
            overflow-y: auto; 
            height: 100vh; 
        }

        /* --- Styles G√©n√©raux des pages --- */
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        .container { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1); padding: 40px; max-width: 800px; margin: 0 auto; }
        
        /* Boutons avec variables */
        .btn-action { background: linear-gradient(135deg, var(--primary-color-start) 0%, var(--primary-color-end) 100%); color: white; padding: 15px 30px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-action:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        .btn-action-secondary { background: linear-gradient(135deg, var(--secondary-color-start) 0%, var(--secondary-color-end) 100%); }
        
        /* Onglet Param√®tres (Nouveau style) */
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        .setting-card { background: #f8f9fa; padding: 20px; border-radius: 12px; border: 1px solid #e0e0e0; }
        .setting-card label { display: block; margin-bottom: 10px; font-weight: 600; color: #555; }
        .setting-card input[type="color"] { width: 100%; height: 50px; border: none; cursor: pointer; border-radius: 8px; }
        .btn-reset { margin-top: 20px; background: #ff6b6b; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }

        /* ... (Reste des styles essentiels conserv√©s mais utilisant les variables o√π n√©cessaire) ... */
        .category-header.active { background: linear-gradient(135deg, var(--secondary-color-start) 0%, var(--secondary-color-end) 100%); color: white; }
        .toggle-sidebar-btn { display: none; } /* Cach√© car menu fixe */
        
        /* Comparateur styles */
        .btn-comparator { background: linear-gradient(135deg, var(--secondary-color-start) 0%, var(--secondary-color-end) 100%); color: white; border: none; border-radius: 8px; padding: 10px 16px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        
        /* Modal & autres */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 400px; width: 90%; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { width: 70px; }
            .sidebar-header h1, .sidebar-header p, .category-name, .folder-info span:nth-child(2) { display: none; }
            .main-content { margin-left: 70px; padding: 20px; }
        }
        
        /* Reste des styles sp√©cifiques (Card, List, etc.) du code initial */
        .list-card { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 25px 30px; border-radius: 15px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .list-card-title { font-size: 22px; font-weight: 600; color: #333; }
        .btn-study { background: linear-gradient(135deg, var(--primary-color-start) 0%, var(--primary-color-end) 100%); color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; }
        
        /* Comparateur specifique */
        #comparatorModal { z-index: 2000; background: rgba(0,0,0,0.8); }
        .comparator-container { background: #0b0c0f; color: #e8ecf3; min-height: 100vh; padding: 20px; }
        .comparator-main { display: grid; grid-template-columns: 1fr 360px; gap: 20px; }
        .comp-panel { background: #14161a; border: 1px solid #23262d; border-radius: 12px; padding: 15px; }
        .comp-controls textarea { width: 100%; background: #0e1014; color: white; border: 1px solid #333; padding: 10px; }
        mark.ins { background: #1f6b36; color: white; text-decoration: none; }
        mark.del { background: #6b1f1f; text-decoration: line-through; color: white; }
    </style>
</head>
<body>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>üìö Flashcards</h1>
            <p>Apprentissage</p>
        </div>
        <div class="sidebar-nav">
            <div class="nav-item active" onclick="showPage('home')"><span>üè†</span><span>Accueil</span></div>
            <div class="nav-item" onclick="showPage('settings')"><span>‚öôÔ∏è</span><span>Param√®tres</span></div>
        </div>
        <div class="folder-section">
            <div class="folder-section-header">
                <h3>Mes Cours</h3>
                <div class="folder-section-buttons">
                    <button class="btn-new-category" onclick="showNewCategoryModal()">üìÅ</button>
                    <button class="btn-new-folder" onclick="showNewFolderModal()">+</button>
                </div>
            </div>
            <div id="categoryList"></div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="app-header" style="padding:10px 40px; display:flex; justify-content:flex-end;">
            <button class="btn-comparator" onclick="openComparator()">üîç Comparateur</button>
        </div>

        <div id="homePage" class="page active">
            <div class="container home-page">
                <div class="home-hero">
                    <h1>Bienvenue ! üëã</h1>
                    <p>Apprends efficacement avec ton syst√®me de flashcards.</p>
                </div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-card-value" id="totalCourses">0</div><div class="stat-card-label">Cours</div></div>
                    <div class="stat-card"><div class="stat-card-value" id="totalCards">0</div><div class="stat-card-label">Cartes</div></div>
                </div>
                <div class="quick-actions" style="margin-top:40px; display:flex; gap:10px; justify-content:center;">
                    <button class="btn-action" onclick="showNewFolderModal()">‚ûï Cr√©er un cours</button>
                    <button class="btn-action btn-action-secondary" onclick="exportCards()">üì¶ Exporter</button>
                    <input type="file" id="fileInput" style="display:none" accept=".json">
                    <button class="btn-action" style="background:#555;" onclick="document.getElementById('fileInput').click()">üì• Importer</button>
                </div>
                <div id="courseList" class="course-list" style="margin-top:40px;"></div>
            </div>
        </div>

        <div id="settingsPage" class="page">
            <div class="container">
                <h2 style="margin-bottom:20px;">üé® Personnalisation</h2>
                <p>Modifie les couleurs de l'application.</p>
                
                <div class="settings-grid">
                    <div class="setting-card">
                        <label>Couleur Principale (D√©but D√©grad√©)</label>
                        <input type="color" id="colorP1" value="#667eea" oninput="updateColors()">
                    </div>
                    <div class="setting-card">
                        <label>Couleur Principale (Fin D√©grad√©)</label>
                        <input type="color" id="colorP2" value="#764ba2" oninput="updateColors()">
                    </div>
                    <div class="setting-card">
                        <label>Couleur Secondaire (D√©but)</label>
                        <input type="color" id="colorS1" value="#11998e" oninput="updateColors()">
                    </div>
                    <div class="setting-card">
                        <label>Couleur Secondaire (Fin)</label>
                        <input type="color" id="colorS2" value="#38ef7d" oninput="updateColors()">
                    </div>
                    <div class="setting-card">
                        <label>Fond G√©n√©ral</label>
                        <input type="color" id="colorBg" value="#f0f2f5" oninput="updateColors()">
                    </div>
                </div>
                <button class="btn-reset" onclick="resetColors()">R√©tablir les couleurs par d√©faut</button>
            </div>
        </div>

        <div id="listsPage" class="page">
            <div class="container">
                <h2 id="listsTitle" style="margin-bottom:20px;">Cours</h2>
                <div id="listsGrid" class="lists-grid"></div>
                <button class="btn-new-list" style="margin-top:20px; width:100%; padding:15px; background:var(--bg-body); border:1px solid #ddd; cursor:pointer;" onclick="showNewListModal()">‚ûï Nouvelle liste</button>
            </div>
        </div>

        <div id="studyPage" class="page">
            <div class="container" style="text-align:center;">
                <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                    <button onclick="showListsPage(currentCategory, currentFolder)" style="border:none; background:none; cursor:pointer; font-size:20px;">‚Üê</button>
                    <h2 id="studyTitle">Titre</h2>
                    <button onclick="editCurrentCard()" style="border:none; background:none; cursor:pointer;">‚úèÔ∏è</button>
                </div>
                
                <div class="card-container" style="perspective:1000px; height:300px; margin-bottom:20px;">
                    <div id="flashcard" class="card" onclick="this.classList.toggle('flipped')" style="width:100%; height:100%; position:relative; transform-style:preserve-3d; transition:transform 0.6s; cursor:pointer;">
                        <div class="card-face card-front" style="position:absolute; width:100%; height:100%; backface-visibility:hidden; background:white; display:flex; align-items:center; justify-content:center; font-size:24px; border:1px solid #eee; border-radius:15px; padding:20px;">
                            <div id="question">Question</div>
                        </div>
                        <div class="card-face card-back" style="position:absolute; width:100%; height:100%; backface-visibility:hidden; background:#f9f9f9; transform:rotateY(180deg); display:flex; align-items:center; justify-content:center; font-size:24px; border:1px solid #eee; border-radius:15px; padding:20px;">
                            <div id="answer">R√©ponse</div>
                        </div>
                    </div>
                </div>

                <div style="display:flex; gap:10px;">
                    <button class="btn-study" style="flex:1;" onclick="nextCard()">Carte Suivante</button>
                </div>
                
                <div style="margin-top:30px; border-top:1px solid #eee; padding-top:20px;">
                    <h3>Ajouter une carte rapide</h3>
                    <input id="newQ" placeholder="Question" style="width:100%; padding:10px; margin-bottom:10px;">
                    <input id="newA" placeholder="R√©ponse" style="width:100%; padding:10px; margin-bottom:10px;">
                    <button class="btn-action" onclick="addCard()">Ajouter</button>
                </div>
            </div>
        </div>
    </div>

    <div id="newCategoryModal" class="modal"><div class="modal-content"><h3>Nouvelle Cat√©gorie</h3><input id="catName" placeholder="Nom" style="width:100%; padding:10px; margin:10px 0;"><button class="btn-action" onclick="createCategory()">Cr√©er</button><button onclick="closeModals()" style="margin-left:10px;">Annuler</button></div></div>
    <div id="newFolderModal" class="modal"><div class="modal-content"><h3>Nouveau Cours</h3><select id="catSelect" style="width:100%; margin:10px 0; padding:10px;"></select><input id="folderName" placeholder="Nom" style="width:100%; padding:10px; margin:10px 0;"><button class="btn-action" onclick="createFolder()">Cr√©er</button><button onclick="closeModals()" style="margin-left:10px;">Annuler</button></div></div>
    <div id="newListModal" class="modal"><div class="modal-content"><h3>Nouvelle Liste</h3><input id="listName" placeholder="Nom" style="width:100%; padding:10px; margin:10px 0;"><button class="btn-action" onclick="createList()">Cr√©er</button><button onclick="closeModals()" style="margin-left:10px;">Annuler</button></div></div>

    <div id="comparatorModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; overflow:auto;">
        <div class="comparator-container">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h2>Comparateur</h2>
                <button class="btn-close-comparator" onclick="closeComparator()">Fermer</button>
            </div>
            <div class="comparator-main">
                <div class="comp-controls">
                    <textarea id="oldText" rows="10" placeholder="Ancien texte..."></textarea>
                    <textarea id="newText" rows="10" placeholder="Nouveau texte..." style="margin-top:10px;"></textarea>
                    <button class="btn-action" style="margin-top:10px;" onclick="computeComp()">Comparer</button>
                </div>
                <div class="comp-panel">
                    <div id="diffOutput" style="white-space:pre-wrap;">R√©sultat...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- LOGIQUE JAVASCRIPT ---
        
        let data = JSON.parse(localStorage.getItem('flashcardsData')) || {};
        let currentCategory = null, currentFolder = null, currentList = null;
        let currentCardIndex = 0;

        // 1. GESTION COULEURS
        function updateColors() {
            const r = document.documentElement.style;
            const p1 = document.getElementById('colorP1').value;
            const p2 = document.getElementById('colorP2').value;
            const s1 = document.getElementById('colorS1').value;
            const s2 = document.getElementById('colorS2').value;
            const bg = document.getElementById('colorBg').value;

            r.setProperty('--primary-color-start', p1);
            r.setProperty('--primary-color-end', p2);
            r.setProperty('--secondary-color-start', s1);
            r.setProperty('--secondary-color-end', s2);
            r.setProperty('--bg-body', bg);

            localStorage.setItem('appColors', JSON.stringify({p1, p2, s1, s2, bg}));
        }

        function loadColors() {
            const c = JSON.parse(localStorage.getItem('appColors'));
            if(c) {
                document.getElementById('colorP1').value = c.p1;
                document.getElementById('colorP2').value = c.p2;
                document.getElementById('colorS1').value = c.s1;
                document.getElementById('colorS2').value = c.s2;
                document.getElementById('colorBg').value = c.bg;
                updateColors();
            }
        }

        function resetColors() {
            localStorage.removeItem('appColors');
            location.reload();
        }

        // 2. NAVIGATION
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId + 'Page').classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(pageId === 'home') document.querySelector('.nav-item:nth-child(1)').classList.add('active');
            if(pageId === 'settings') document.querySelector('.nav-item:nth-child(2)').classList.add('active');
        }

        function showListsPage(cat, folder) {
            currentCategory = cat; currentFolder = folder;
            document.getElementById('listsTitle').innerText = folder;
            renderLists();
            showPage('lists');
        }

        function showStudyPage(cat, folder, list) {
            currentCategory = cat; currentFolder = folder; currentList = list;
            document.getElementById('studyTitle').innerText = list;
            currentCardIndex = 0;
            loadCard();
            showPage('study');
        }

        // 3. RENDU SIDEBAR
        function renderSidebar() {
            const c = document.getElementById('categoryList');
            const s = document.getElementById('catSelect');
            c.innerHTML = ''; s.innerHTML = '';
            
            let totalC = 0, totalCards = 0;

            Object.keys(data).forEach(cat => {
                // Option pour select
                let opt = document.createElement('option'); opt.value = cat; opt.innerText = cat; s.appendChild(opt);

                // Sidebar items
                let div = document.createElement('div');
                div.innerHTML = `<div style="padding:10px; font-weight:bold; background:#f5f7fa; margin-top:5px;">${cat}</div>`;
                
                Object.keys(data[cat]).forEach(fold => {
                    totalC++;
                    let f = document.createElement('div');
                    f.className = 'nav-item';
                    f.style.paddingLeft = "20px";
                    f.innerText = "üìñ " + fold;
                    f.onclick = () => showListsPage(cat, fold);
                    div.appendChild(f);
                    
                    // Compte cartes
                    Object.values(data[cat][fold]).forEach(l => totalCards += l.length);
                });
                c.appendChild(div);
            });
            document.getElementById('totalCourses').innerText = totalC;
            document.getElementById('totalCards').innerText = totalCards;
        }

        function renderLists() {
            const g = document.getElementById('listsGrid'); g.innerHTML = '';
            if(!data[currentCategory] || !data[currentCategory][currentFolder]) return;
            
            Object.keys(data[currentCategory][currentFolder]).forEach(list => {
                let div = document.createElement('div');
                div.className = 'list-card';
                div.innerHTML = `<div><div class="list-card-title">${list}</div><small>${data[currentCategory][currentFolder][list].length} cartes</small></div>
                <button class="btn-study" onclick="showStudyPage('${currentCategory}', '${currentFolder}', '${list}')">Ouvrir</button>`;
                g.appendChild(div);
            });
        }

        // 4. LOGIQUE METIER
        function loadCard() {
            const list = data[currentCategory][currentFolder][currentList];
            if(list && list.length > 0) {
                if(currentCardIndex >= list.length) currentCardIndex = 0;
                document.getElementById('question').innerText = list[currentCardIndex].q;
                document.getElementById('answer').innerText = list[currentCardIndex].a;
            } else {
                document.getElementById('question').innerText = "Vide";
                document.getElementById('answer').innerText = "...";
            }
            document.getElementById('flashcard').classList.remove('flipped');
        }

        function nextCard() {
            const list = data[currentCategory][currentFolder][currentList];
            if(list && list.length > 0) {
                currentCardIndex = (currentCardIndex + 1) % list.length;
                loadCard();
            }
        }

        function addCard() {
            const q = document.getElementById('newQ').value;
            const a = document.getElementById('newA').value;
            if(q && a) {
                data[currentCategory][currentFolder][currentList].push({q, a});
                saveData();
                document.getElementById('newQ').value = '';
                document.getElementById('newA').value = '';
                loadCard();
                renderSidebar(); // maj stats
            }
        }

        // Modals logic
        function showNewCategoryModal() { document.getElementById('newCategoryModal').classList.add('show'); }
        function showNewFolderModal() { document.getElementById('newFolderModal').classList.add('show'); }
        function showNewListModal() { document.getElementById('newListModal').classList.add('show'); }
        function closeModals() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('show')); }

        function createCategory() {
            let n = document.getElementById('catName').value;
            if(n && !data[n]) { data[n] = {}; saveData(); closeModals(); renderSidebar(); }
        }
        function createFolder() {
            let c = document.getElementById('catSelect').value;
            let n = document.getElementById('folderName').value;
            if(c && n) { data[c][n] = {}; saveData(); closeModals(); renderSidebar(); }
        }
        function createList() {
            let n = document.getElementById('listName').value;
            if(n) { data[currentCategory][currentFolder][n] = []; saveData(); closeModals(); renderLists(); }
        }

        function saveData() { localStorage.setItem('flashcardsData', JSON.stringify(data)); }
        
        // Export/Import simplifi√©s
        function exportCards() {
            const blob = new Blob([JSON.stringify(data)], {type:'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'backup.json'; a.click();
        }
        document.getElementById('fileInput').onchange = function(e) {
            const reader = new FileReader();
            reader.onload = function(ev) { data = JSON.parse(ev.target.result); saveData(); renderSidebar(); alert('Import√© !'); };
            reader.readAsText(e.target.files[0]);
        };

        // Comparateur simplifi√©
        function openComparator() { document.getElementById('comparatorModal').style.display = 'block'; }
        function closeComparator() { document.getElementById('comparatorModal').style.display = 'none'; }
        function computeComp() {
            const oldT = document.getElementById('oldText').value;
            const newT = document.getElementById('newText').value;
            if(window.Diff) {
                const diff = Diff.diffWordsWithSpace(oldT, newT);
                let html = '';
                diff.forEach(part => {
                    const color = part.added ? '#d4edda' : part.removed ? '#f8d7da' : 'transparent';
                    const span = `<span style="background:${color}; text-decoration:${part.removed ? 'line-through' : 'none'}">${part.value}</span>`;
                    html += span;
                });
                document.getElementById('diffOutput').innerHTML = html;
            } else {
                document.getElementById('diffOutput').innerText = "Erreur librairie Diff non charg√©e.";
            }
        }

        // Init
        window.onload = function() {
            loadColors();
            if(Object.keys(data).length === 0) {
                data = {"Mon Cours Ex": {"Chapitre 1": {"Intro": [{q:"Exemple Q", a:"Exemple R"}]}}};
                saveData();
            }
            renderSidebar();
        };
    </script>
</body>
</html>
